import{j as e,r as m,f as H,L as z,g as P,R as W,h as q,i as V,d as D,k as J}from"./index-B7WG_kHJ-1769026461592.js";import{m as F}from"./motion-DSM7Rpg2-1769026461592.js";const y={border:"rgba(106, 212, 160, 0.15)",borderActive:"rgba(106, 212, 160, 0.5)",borderHover:"rgba(106, 212, 160, 0.35)",activeBg:"rgba(106, 212, 160, 0.12)",activeShadow:"0 6px 28px rgba(106, 212, 160, 0.2), 0 8px 32px rgba(0, 0, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3)",highlightActive:"linear-gradient(90deg, transparent, rgba(160, 232, 196, 0.5), transparent)",highlightDefault:"linear-gradient(90deg, transparent, rgba(160, 232, 196, 0.3), transparent)"},T=({children:t,className:r="",variant:x="default",padding:g=!0,hover:s=!1,onClick:n})=>{const l=x==="active",c=g?"p-4":"",i={background:l?`linear-gradient(165deg, ${y.activeBg}, #1e1c18)`:"linear-gradient(165deg, #2a2722 0%, #1e1c18 50%, #1a1816 100%)",border:`1px solid ${l?y.borderActive:y.border}`,borderRadius:"28px",boxShadow:l?y.activeShadow:"0 8px 32px rgba(0, 0, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255,255,255,0.06)",position:"relative",overflow:"hidden"},d={position:"absolute",top:0,left:"25%",right:"25%",height:"1px",background:l?y.highlightActive:y.highlightDefault,pointerEvents:"none"};return s||n?e.jsxs(F.div,{className:`${c} ${r}`,style:i,onClick:n,whileHover:{borderColor:y.borderHover,boxShadow:"0 12px 40px rgba(0, 0, 0, 0.6), 0 4px 12px rgba(0, 0, 0, 0.4)",y:-2},whileTap:n?{scale:.98}:void 0,transition:{duration:.2},children:[e.jsx("div",{style:d}),t]}):e.jsxs("div",{className:`${c} ${r}`,style:i,children:[e.jsx("div",{style:d}),t]})},R={accent:"#6ad4a0",border:"rgba(106, 212, 160, 0.15)",focusRing:"rgba(106, 212, 160, 0.15)"},v=m.forwardRef(({label:t,error:r,className:x="",style:g,...s},n)=>{const l={width:"100%",padding:"14px 18px",background:"#1a1816",border:`1px solid ${r?"#ef4444":R.border}`,borderRadius:"16px",color:"#ffffff",fontSize:"14px",fontFamily:"inherit",transition:"all 0.2s ease",boxShadow:"inset 0 2px 4px rgba(0, 0, 0, 0.2)",outline:"none",...g},c={display:"block",marginBottom:"8px",fontSize:"11px",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.1em",color:"rgba(255, 255, 255, 0.5)"};return e.jsxs("div",{style:{width:"100%"},children:[t&&e.jsx("label",{style:c,children:t}),e.jsx("input",{ref:n,style:l,className:x,onFocus:i=>{var d;i.target.style.borderColor=r?"#ef4444":R.accent,i.target.style.boxShadow=`inset 0 2px 4px rgba(0, 0, 0, 0.2), 0 0 0 3px ${r?"rgba(239, 68, 68, 0.15)":R.focusRing}`,(d=s.onFocus)==null||d.call(s,i)},onBlur:i=>{var d;i.target.style.borderColor=r?"#ef4444":R.border,i.target.style.boxShadow="inset 0 2px 4px rgba(0, 0, 0, 0.2)",(d=s.onBlur)==null||d.call(s,i)},...s}),r&&e.jsx("p",{style:{marginTop:"8px",fontSize:"12px",color:"#ef4444"},children:r})]})});v.displayName="AuthInput";const $={accent:"#6ad4a0",accentLight:"#a0e8c4",accentDark:"#4aa870"},Z=({children:t,variant:r="primary",size:x="md",fullWidth:g=!1,className:s="",disabled:n,...l})=>{const c={sm:{padding:"8px 16px",fontSize:"13px"},md:{padding:"12px 24px",fontSize:"14px"},lg:{padding:"16px 32px",fontSize:"16px"}},i=()=>{switch(r){case"primary":return{background:`linear-gradient(165deg, ${$.accentDark}, ${$.accent})`,color:"#0a0a0c",border:"none",boxShadow:"0 4px 16px rgba(106, 212, 160, 0.3)"};case"secondary":return{background:"linear-gradient(165deg, #2a2722 0%, #1e1c18 50%, #1a1816 100%)",color:$.accentLight,border:`1px solid ${$.accent}`,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3)"};case"ghost":return{background:"linear-gradient(165deg, #2a2722 0%, #1e1c18 50%, #1a1816 100%)",color:"#ffffff",border:"1px solid rgba(106, 212, 160, 0.15)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3)"};default:return{}}},d={borderRadius:"20px",fontWeight:600,fontFamily:"inherit",cursor:n?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:n?.5:1,width:g?"100%":"auto",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"8px",...c[x],...i()};return e.jsx(F.button,{style:d,className:s,disabled:n,whileHover:n?void 0:{y:-2,scale:1.02,boxShadow:r==="primary"?"0 6px 24px rgba(106, 212, 160, 0.5)":"0 12px 40px rgba(0, 0, 0, 0.6), 0 4px 12px rgba(0, 0, 0, 0.4)"},whileTap:n?void 0:{scale:.98},transition:{duration:.2},...l,children:t})},a={accent:"#6ad4a0",accentLight:"#a0e8c4",accentDark:"#4aa870",border:"rgba(106, 212, 160, 0.15)",textMuted:"rgba(255, 255, 255, 0.5)"},O=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),U=t=>{const r=[];return t.length<8&&r.push("Minimo 8 caratteri"),/[a-z]/.test(t)||r.push("Almeno una lettera minuscola"),/[A-Z]/.test(t)||r.push("Almeno una lettera maiuscola"),/\d/.test(t)||r.push("Almeno un numero"),{valid:r.length===0,errors:r}},_=t=>{let r=0;return t.length>=8&&r++,t.length>=12&&r++,/[a-z]/.test(t)&&r++,/[A-Z]/.test(t)&&r++,/\d/.test(t)&&r++,/[^a-zA-Z\d]/.test(t)&&r++,r<=2?{strength:r,label:"Debole",color:"#ef4444"}:r<=4?{strength:r,label:"Media",color:"#f59e0b"}:{strength:r,label:"Forte",color:"#10b981"}},N=t=>t.trim().replace(/[<>]/g,""),Q=()=>{const[t,r]=m.useState({nome:"",cognome:"",email:"",password:"",confirmPassword:"",ruolo:"proprietario"}),x=m.useRef(null),g=m.useRef(null),[s,n]=m.useState(""),[l,c]=m.useState([]),[i,d]=m.useState(!1),[M,B]=m.useState(!1),A=_(t.password),E=()=>{var f,b;const p=((f=x.current)==null?void 0:f.checked)??!1,h=((b=g.current)==null?void 0:b.checked)??!1;console.log("VALIDATE - gdprChecked:",p,"ageChecked:",h);const o=[];if((!t.nome||t.nome.length<2)&&o.push("Nome troppo corto (minimo 2 caratteri)"),(!t.cognome||t.cognome.length<2)&&o.push("Cognome troppo corto (minimo 2 caratteri)"),t.email?O(t.email)||o.push("Email non valida"):o.push("Email richiesta"),!t.password)o.push("Password richiesta");else{const{valid:j,errors:w}=U(t.password);j||o.push(...w.map(k=>`Password: ${k}`))}return t.confirmPassword?t.password!==t.confirmPassword&&o.push("Le password non corrispondono"):o.push("Conferma password richiesta"),p||o.push("Devi accettare la Privacy Policy e i Termini di Servizio"),h||o.push("Devi confermare di avere almeno 16 anni"),c(o),o.length===0},S=p=>{const{name:h,value:o,type:f,checked:b}=p.target;r(j=>({...j,[h]:f==="checkbox"?b:o})),l.length>0&&c([])},I=async p=>{var f,b,j,w,k,L;p.preventDefault();const h=((f=x.current)==null?void 0:f.checked)??!1,o=((b=g.current)==null?void 0:b.checked)??!1;if(console.log("SUBMIT - gdprChecked:",h,"ageChecked:",o),n(""),c([]),!!E()){d(!0);try{const u={nome:N(t.nome),cognome:N(t.cognome),email:N(t.email).toLowerCase(),password:t.password,ruolo:t.ruolo,gdprAccepted:h===!0,ageConfirmed:o===!0};console.log("[FE] Sending to backend:",JSON.stringify(u)),await J.register(u),B(!0)}catch(u){if(d(!1),((j=u.response)==null?void 0:j.status)===429)n("Troppi tentativi di registrazione. Riprova tra un'ora.");else if(((w=u.response)==null?void 0:w.status)===400){const C=(k=u.response.data)==null?void 0:k.error;C!=null&&C.includes("già registrata")?n("Email già registrata. Usa un'altra email o effettua il login."):(L=u.response.data)!=null&&L.details?c(u.response.data.details):n(C||"Dati non validi. Controlla i campi.")}else n("Errore durante la registrazione. Riprova più tardi.")}}};return M?e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative",style:{background:"radial-gradient(ellipse 80% 50% at 50% -10%, rgba(106, 212, 160, 0.08) 0%, transparent 60%), linear-gradient(to bottom, #12110f 0%, #0a0a09 100%)",fontFamily:'"Plus Jakarta Sans", -apple-system, BlinkMacSystemFont, sans-serif'},children:[e.jsx("div",{className:"fixed inset-0 pointer-events-none",style:{background:"radial-gradient(ellipse 100% 40% at 50% 0%, rgba(106, 212, 160, 0.06) 0%, transparent 70%)"}}),e.jsx(T,{className:"w-full max-w-md relative z-10",children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{style:{padding:"16px",borderRadius:"24px",background:"linear-gradient(145deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1))",boxShadow:"0 4px 20px rgba(16, 185, 129, 0.2)"},children:e.jsx(H,{size:48,style:{color:"#10b981",filter:"drop-shadow(0 0 8px #10b981)"}})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{background:"linear-gradient(135deg, #10b981, #6ad4a0)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Controlla la tua Email!"}),e.jsx("p",{style:{color:a.textMuted,fontSize:"14px",marginBottom:"8px"},children:"Ti abbiamo inviato un link di verifica a:"}),e.jsx("p",{style:{color:a.accentLight,fontSize:"15px",fontWeight:600,marginBottom:"16px"},children:t.email}),e.jsxs("p",{style:{color:a.textMuted,fontSize:"13px",marginBottom:"20px",lineHeight:1.5},children:["Clicca sul link nell'email per attivare il tuo account.",e.jsx("br",{}),"Controlla anche la cartella spam."]}),e.jsxs(z,{to:"/login",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"12px 24px",fontSize:"14px",fontWeight:600,color:"#0a0a09",background:`linear-gradient(135deg, ${a.accentLight}, ${a.accent})`,borderRadius:"12px",textDecoration:"none"},children:[e.jsx(P,{size:16}),"Vai al Login"]})]})})]}):e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative",style:{background:"radial-gradient(ellipse 80% 50% at 50% -10%, rgba(106, 212, 160, 0.08) 0%, transparent 60%), linear-gradient(to bottom, #12110f 0%, #0a0a09 100%)",fontFamily:'"Plus Jakarta Sans", -apple-system, BlinkMacSystemFont, sans-serif'},children:[e.jsx("div",{className:"fixed inset-0 pointer-events-none",style:{background:"radial-gradient(ellipse 100% 40% at 50% 0%, rgba(106, 212, 160, 0.06) 0%, transparent 70%)"}}),e.jsxs(T,{className:"w-full max-w-md relative z-10",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{style:{padding:"16px",borderRadius:"24px",background:`linear-gradient(145deg, ${a.accent}33, ${a.accent}1A)`,boxShadow:`0 4px 20px ${a.accent}33`},children:e.jsx(W,{size:32,style:{color:a.accentLight,filter:`drop-shadow(0 0 8px ${a.accent})`}})})}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",style:{background:`linear-gradient(135deg, ${a.accentLight}, ${a.accent}, ${a.accentDark})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:`0 0 40px ${a.accent}30`},children:"Crea Account"}),e.jsx("p",{style:{color:a.textMuted,fontSize:"14px"},children:"Registrati per accedere a OmniaPi"})]}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(v,{type:"text",name:"nome",label:"Nome",value:t.nome,onChange:S,required:!0,placeholder:"Mario",disabled:i}),e.jsx(v,{type:"text",name:"cognome",label:"Cognome",value:t.cognome,onChange:S,required:!0,placeholder:"Rossi",disabled:i})]}),e.jsx(v,{type:"email",name:"email",label:"Email",value:t.email,onChange:S,required:!0,autoComplete:"email",placeholder:"esempio@email.com",disabled:i}),e.jsxs("div",{children:[e.jsx(v,{type:"password",name:"password",label:"Password",value:t.password,onChange:S,required:!0,autoComplete:"new-password",placeholder:"••••••••",disabled:i}),t.password&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"flex-1 h-2 rounded-full overflow-hidden",style:{background:a.border},children:e.jsx("div",{className:"h-full transition-all duration-300",style:{width:`${A.strength/6*100}%`,background:A.color}})}),e.jsx("span",{style:{fontSize:"11px",color:a.textMuted,whiteSpace:"nowrap"},children:A.label})]}),e.jsx("p",{style:{fontSize:"11px",color:a.textMuted},children:"Requisiti: 8+ caratteri, maiuscola, minuscola, numero"})]})]}),e.jsx(v,{type:"password",name:"confirmPassword",label:"Conferma Password",value:t.confirmPassword,onChange:S,required:!0,autoComplete:"new-password",placeholder:"••••••••",disabled:i}),e.jsxs("div",{style:{marginTop:"8px"},children:[e.jsx("label",{style:{display:"block",fontSize:"13px",fontWeight:500,color:"rgba(255, 255, 255, 0.7)",marginBottom:"10px"},children:"Registrati come"}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("button",{type:"button",onClick:()=>r(p=>({...p,ruolo:"proprietario"})),disabled:i,style:{flex:1,padding:"14px 12px",borderRadius:"14px",background:t.ruolo==="proprietario"?`linear-gradient(145deg, ${a.accent}25, ${a.accent}15)`:"rgba(255, 255, 255, 0.03)",border:t.ruolo==="proprietario"?`2px solid ${a.accent}`:"2px solid rgba(255, 255, 255, 0.1)",cursor:i?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:i?.5:1},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[e.jsx(q,{size:24,style:{color:t.ruolo==="proprietario"?a.accent:"rgba(255, 255, 255, 0.5)"}}),e.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:t.ruolo==="proprietario"?a.accentLight:"rgba(255, 255, 255, 0.7)"},children:"Proprietario"}),e.jsx("span",{style:{fontSize:"11px",color:"rgba(255, 255, 255, 0.45)",textAlign:"center",lineHeight:1.3},children:"Per gestire la tua casa"})]})}),e.jsx("button",{type:"button",onClick:()=>r(p=>({...p,ruolo:"installatore"})),disabled:i,style:{flex:1,padding:"14px 12px",borderRadius:"14px",background:t.ruolo==="installatore"?`linear-gradient(145deg, ${a.accent}25, ${a.accent}15)`:"rgba(255, 255, 255, 0.03)",border:t.ruolo==="installatore"?`2px solid ${a.accent}`:"2px solid rgba(255, 255, 255, 0.1)",cursor:i?"not-allowed":"pointer",transition:"all 0.2s ease",opacity:i?.5:1},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[e.jsx(V,{size:24,style:{color:t.ruolo==="installatore"?a.accent:"rgba(255, 255, 255, 0.5)"}}),e.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:t.ruolo==="installatore"?a.accentLight:"rgba(255, 255, 255, 0.7)"},children:"Installatore"}),e.jsx("span",{style:{fontSize:"11px",color:"rgba(255, 255, 255, 0.45)",textAlign:"center",lineHeight:1.3},children:"Per gestire impianti clienti"})]})})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginTop:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px"},children:[e.jsx("input",{type:"checkbox",id:"gdprAccepted",ref:x,onChange:()=>{l.length>0&&c([])},disabled:i,style:{width:"18px",height:"18px",accentColor:a.accent,cursor:i?"not-allowed":"pointer",marginTop:"2px",flexShrink:0}}),e.jsxs("label",{htmlFor:"gdprAccepted",style:{fontSize:"13px",color:a.textMuted,lineHeight:1.4,cursor:i?"not-allowed":"pointer"},children:["Ho letto e accetto la"," ",e.jsx(z,{to:"/privacy",target:"_blank",style:{color:a.accentLight,textDecoration:"underline"},children:"Privacy Policy"})," ","e i"," ",e.jsx(z,{to:"/terms",target:"_blank",style:{color:a.accentLight,textDecoration:"underline"},children:"Termini di Servizio"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px"},children:[e.jsx("input",{type:"checkbox",id:"ageConfirmed",ref:g,onChange:()=>{l.length>0&&c([])},disabled:i,style:{width:"18px",height:"18px",accentColor:a.accent,cursor:i?"not-allowed":"pointer",marginTop:"2px",flexShrink:0}}),e.jsx("label",{htmlFor:"ageConfirmed",style:{fontSize:"13px",color:a.textMuted,lineHeight:1.4,cursor:i?"not-allowed":"pointer"},children:"Confermo di avere almeno 16 anni di eta"})]})]}),l.length>0&&e.jsx("div",{style:{padding:"12px",borderRadius:"16px",background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(D,{size:18,style:{color:"#f59e0b",flexShrink:0,marginTop:"2px"}}),e.jsx("div",{children:l.map((p,h)=>e.jsx("p",{style:{fontSize:"13px",color:"#f59e0b"},children:p},h))})]})}),s&&e.jsx("div",{style:{padding:"12px",borderRadius:"16px",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(D,{size:18,style:{color:"#ef4444",flexShrink:0,marginTop:"2px"}}),e.jsx("p",{style:{fontSize:"13px",color:"#ef4444"},children:s})]})}),e.jsx(Z,{type:"submit",fullWidth:!0,disabled:i,variant:"primary",children:i?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"animate-spin",children:"⚙️"}),e.jsx("span",{children:"Registrazione in corso..."})]}):"Crea Account"}),e.jsx("div",{className:"text-center pt-2",children:e.jsxs(z,{to:"/login",className:"inline-flex items-center gap-1 transition-all",style:{fontSize:"13px",color:a.accentLight},children:[e.jsx(P,{size:16}),e.jsx("span",{children:"Hai già un account? Accedi"})]})})]}),e.jsx("div",{className:"mt-6 pt-4",style:{borderTop:`1px solid ${a.border}`},children:e.jsx("p",{style:{fontSize:"11px",color:a.textMuted,textAlign:"center"},children:"Password criptata con bcrypt - Connessione SSL/TLS"})})]})]})};export{Q as Register};
