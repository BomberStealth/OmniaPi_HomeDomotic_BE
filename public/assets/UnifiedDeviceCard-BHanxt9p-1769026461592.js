import{r as o,p as Z,aa as U,x as Q,j as e,z as V,ab as ee,m as te,ac as ne,y as oe,ad as re,Z as se,ae as q,a8 as ie,af as ae,K as le}from"./index-B7WG_kHJ-1769026461592.js";import{T as ce}from"./Toggle-B6i1zhXp-1769026461592.js";import{m as N}from"./motion-DSM7Rpg2-1769026461592.js";import{A as de}from"./index-yirOBEcN-1769026461592.js";const X={puo_controllare_dispositivi:!0,puo_vedere_stato:!0,stanze_abilitate:null},Me=a=>{const[t,i]=o.useState(X),[d,r]=o.useState(!1),[n,x]=o.useState(null),p=o.useRef(null),h=o.useCallback(async()=>{var j;if(a&&p.current!==a){r(!0),x(null);try{const u=await Z.get(`/api/impianti/${a}/miei-permessi`);u.data.success&&(i(u.data.data),p.current=a)}catch(u){((j=u.response)==null?void 0:j.status)===403?i({puo_controllare_dispositivi:!1,puo_vedere_stato:!1,stanze_abilitate:[]}):(console.error("Errore fetch permessi:",u),x(u.message||"Errore nel recupero permessi"),i(X))}finally{r(!1)}}},[a]);o.useEffect(()=>{a&&(p.current!==a&&(p.current=null,i(X)),h())},[a,h]),o.useEffect(()=>{const j=u=>{u.tipo==="permessi-aggiornati"&&u.impianto_id===a&&(console.log("ðŸ“¡ Permessi aggiornati ricevuti via WS:",u),i(y=>({...y,puo_controllare_dispositivi:u.puo_controllare_dispositivi,puo_vedere_stato:u.puo_vedere_stato,stanze_abilitate:u.stanze_abilitate})))};return U.onNotification(j),()=>{U.offNotification()}},[a]);const m=o.useCallback(j=>t.puo_controllare_dispositivi?t.stanze_abilitate===null?!0:t.stanze_abilitate.includes(j):!1,[t]),k=o.useCallback(j=>t.puo_vedere_stato?t.stanze_abilitate===null?!0:t.stanze_abilitate.includes(j):!1,[t]);return{permessi:t,loading:d,error:n,refetch:h,canControlStanza:m,canViewStanza:k,canControl:t.puo_controllare_dispositivi,canViewState:t.puo_vedere_stato}},pe=a=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return t?`${parseInt(t[1],16)}, ${parseInt(t[2],16)}, ${parseInt(t[3],16)}`:"106, 212, 160"},ue=[{id:0,name:"Statico"},{id:1,name:"Rainbow"},{id:2,name:"Respiro"},{id:3,name:"Chase"},{id:4,name:"Sparkle"},{id:5,name:"Fuoco"},{id:6,name:"Custom"}],H="omniapi-led-custom-effect-colors",J=({effect:a,color:t,size:i,isOn:d})=>{const r=`rgb(${t.r}, ${t.g}, ${t.b})`;if(o.useMemo(()=>{if(typeof document>"u")return;const x="led-effect-animations";if(!document.getElementById(x)){const p=document.createElement("style");p.id=x,p.textContent=`
        @keyframes led-rainbow {
          0% { color: #ff0000; }
          17% { color: #ff8800; }
          33% { color: #ffff00; }
          50% { color: #00ff00; }
          67% { color: #0088ff; }
          83% { color: #8800ff; }
          100% { color: #ff0000; }
        }
        @keyframes led-breathing {
          0%, 100% { opacity: 0.4; transform: scale(0.95); }
          50% { opacity: 1; transform: scale(1.05); }
        }
        @keyframes led-chase {
          0% { filter: brightness(0.6) hue-rotate(0deg); }
          50% { filter: brightness(1.2) hue-rotate(30deg); }
          100% { filter: brightness(0.6) hue-rotate(0deg); }
        }
        @keyframes led-sparkle {
          0%, 100% { opacity: 1; filter: brightness(1); }
          25% { opacity: 0.5; filter: brightness(1.5); }
          50% { opacity: 1; filter: brightness(0.8); }
          75% { opacity: 0.7; filter: brightness(1.3); }
        }
        @keyframes led-fire {
          0% { color: #ff4500; filter: brightness(1); }
          25% { color: #ff6600; filter: brightness(1.2); }
          50% { color: #ffaa00; filter: brightness(0.9); }
          75% { color: #ff5500; filter: brightness(1.1); }
          100% { color: #ff4500; filter: brightness(1); }
        }
        /* Slider thumb styles */
        input[type="range"]::-webkit-slider-thumb {
          -webkit-appearance: none;
          width: 16px;
          height: 16px;
          border-radius: 50%;
          background: #fff;
          cursor: pointer;
          box-shadow: 0 2px 6px rgba(0,0,0,0.3);
          border: 2px solid rgba(255,255,255,0.8);
        }
        input[type="range"]::-moz-range-thumb {
          width: 16px;
          height: 16px;
          border-radius: 50%;
          background: #fff;
          cursor: pointer;
          box-shadow: 0 2px 6px rgba(0,0,0,0.3);
          border: 2px solid rgba(255,255,255,0.8);
        }
      `,document.head.appendChild(p)}},[]),!d)return e.jsx(q,{size:i,style:{color:"rgba(150, 150, 150, 0.6)"}});const n=()=>{switch(a){case 0:return{color:r,filter:`drop-shadow(0 0 6px ${r})`};case 1:return{animation:"led-rainbow 2s linear infinite",filter:"drop-shadow(0 0 6px currentColor)"};case 2:return{color:r,animation:"led-breathing 2s ease-in-out infinite",filter:`drop-shadow(0 0 8px ${r})`};case 3:return{color:r,animation:"led-chase 1s ease-in-out infinite",filter:`drop-shadow(0 0 6px ${r})`};case 4:return{color:r,animation:"led-sparkle 0.5s ease-in-out infinite",filter:`drop-shadow(0 0 8px ${r})`};case 5:return{animation:"led-fire 0.8s ease-in-out infinite",filter:"drop-shadow(0 0 8px #ff6600)"};default:return{color:r}}};return e.jsx(q,{size:i,style:n()})},xe=18,he=({value:a,onChange:t,color:i,effect:d,colors:r})=>{const[n,x]=o.useState(a),p=o.useRef(0),h=o.useRef(!1),m=o.useRef(null),k=d===1?xe:1,j=d===0?i:"#ffffff";o.useEffect(()=>{h.current||x(a)},[a]);const u=o.useCallback(b=>{const w=Date.now();w-p.current>=250&&(t(b),p.current=w)},[t]),y=o.useCallback(b=>{if(!m.current)return n;const w=m.current.getBoundingClientRect(),z=Math.max(0,Math.min(b-w.left,w.width))/w.width;let s=Math.round(k+z*(255-k));return s=Math.max(k,Math.min(255,s)),s},[k,n]),M=o.useCallback(b=>{h.current=!0;const w=y(b);x(w),u(w)},[y,u]),_=o.useCallback(b=>{if(!h.current)return;const w=y(b);x(w),u(w)},[y,u]),R=o.useCallback(()=>{h.current&&(h.current=!1,t(n),p.current=0)},[n,t]),P=o.useCallback(b=>{b.preventDefault(),b.stopPropagation(),M(b.clientX);const w=z=>{z.preventDefault(),_(z.clientX)},E=z=>{z.preventDefault(),R(),document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",E)};document.addEventListener("mousemove",w),document.addEventListener("mouseup",E)},[M,_,R]),l=o.useCallback(b=>{b.stopPropagation(),M(b.touches[0].clientX)},[M]),c=o.useCallback(b=>{_(b.touches[0].clientX)},[_]),f=o.useCallback(()=>{R()},[R]),$=(n-k)/(255-k)*100;return e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[e.jsxs("span",{style:{fontSize:"11px",color:r.textMuted,fontWeight:500},children:["LuminositÃ ",d===1?" (min 7%)":""]}),e.jsxs("span",{style:{fontSize:"11px",color:r.textPrimary,fontWeight:600},children:[Math.round(n/255*100),"%"]})]}),e.jsx("div",{ref:m,onMouseDown:P,onTouchStart:l,onTouchMove:c,onTouchEnd:f,onClick:b=>b.stopPropagation(),style:{width:"100%",height:"24px",display:"flex",alignItems:"center",cursor:"pointer",touchAction:"none",userSelect:"none"},children:e.jsx("div",{style:{width:"100%",height:"6px",borderRadius:"3px",background:`linear-gradient(to right, rgba(50,50,50,0.8), ${j})`,position:"relative"},children:e.jsx("div",{style:{position:"absolute",left:`${$}%`,top:"50%",transform:"translate(-50%, -50%)",width:"16px",height:"16px",borderRadius:"50%",background:"#fff",boxShadow:"0 2px 6px rgba(0,0,0,0.3)",border:"2px solid rgba(255,255,255,0.8)",pointerEvents:"none"}})})})]})},F="omniapi-led-custom-color",K=(a,t,i)=>{t/=100,i/=100;const d=t*Math.min(i,1-i),r=n=>{const x=(n+a/30)%12;return i-d*Math.max(Math.min(x-3,9-x,1),-1)};return{r:Math.round(r(0)*255),g:Math.round(r(8)*255),b:Math.round(r(4)*255)}},G=(a,t,i)=>{a/=255,t/=255,i/=255;const d=Math.max(a,t,i),r=Math.min(a,t,i);let n=0,x=0;const p=(d+r)/2;if(d!==r){const h=d-r;switch(x=p>.5?h/(2-d-r):h/(d+r),d){case a:n=((t-i)/h+(t<i?6:0))*60;break;case t:n=((i-a)/h+2)*60;break;case i:n=((a-t)/h+4)*60;break}}return{h:Math.round(n),s:Math.round(x*100),l:Math.round(p*100)}},ge=({color:a,onChange:t,colors:i})=>{const[d,r]=o.useState(!1),[n,x]=o.useState(a),p=o.useRef(0),h=o.useRef(null),m=o.useRef(!1),[k,j]=o.useState(()=>{try{const s=localStorage.getItem(F);if(s)return JSON.parse(s)}catch{}return null}),u=[{r:255,g:255,b:255},{r:255,g:200,b:150},{r:255,g:100,b:100},{r:100,g:255,b:100},{r:100,g:100,b:255},{r:255,g:200,b:50},{r:255,g:100,b:200},{r:100,g:255,b:255}],y=k?[k,...u]:u,M=o.useCallback(s=>{const v=Date.now();v-p.current>=250&&(t(s),p.current=v)},[t]),_=o.useCallback(s=>{x(s),M(s)},[M]),R=o.useCallback((s,v)=>{if(!h.current)return n;const S=h.current.getBoundingClientRect(),L=S.width/2,g=S.height/2,W=s-S.left-L,I=v-S.top-g,A=Math.min(L,g);let T=Math.atan2(I,W)*(180/Math.PI)+90;T<0&&(T+=360);const D=Math.min(Math.sqrt(W*W+I*I),A)/A*100;return K(T,D,50)},[n]),P=o.useCallback((s,v)=>{m.current=!0;const S=R(s,v);x(S),M(S)},[R,M]),l=o.useCallback((s,v)=>{if(!m.current)return;const S=R(s,v);x(S),M(S)},[R,M]),c=o.useCallback(()=>{m.current&&(m.current=!1,j(n),localStorage.setItem(F,JSON.stringify(n)),t(n),p.current=0)},[n,t]),f=o.useCallback(s=>{s.preventDefault(),s.stopPropagation(),P(s.clientX,s.clientY);const v=L=>{L.preventDefault(),l(L.clientX,L.clientY)},S=()=>{c(),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",S)};document.addEventListener("mousemove",v),document.addEventListener("mouseup",S)},[P,l,c]),$=o.useCallback(s=>{s.stopPropagation(),P(s.touches[0].clientX,s.touches[0].clientY)},[P]),b=o.useCallback(s=>{l(s.touches[0].clientX,s.touches[0].clientY)},[l]),w=G(n.r,n.g,n.b),E=(w.h-90)*(Math.PI/180),z=w.s/100*50;return e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"11px",color:i.textMuted,fontWeight:500,display:"block",marginBottom:"8px"},children:"Colore"}),e.jsxs("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap",alignItems:"center"},children:[y.map((s,v)=>{const S=s.r===a.r&&s.g===a.g&&s.b===a.b,L=v===0&&k!==null;return e.jsx("button",{onClick:g=>{g.stopPropagation(),_(s)},style:{width:"28px",height:"28px",borderRadius:"8px",background:`rgb(${s.r}, ${s.g}, ${s.b})`,border:S?"2px solid white":L?"1px dashed rgba(255,255,255,0.5)":"1px solid rgba(255,255,255,0.2)",cursor:"pointer",boxShadow:S?`0 0 8px rgb(${s.r}, ${s.g}, ${s.b})`:"none",transition:"all 0.15s ease"}},v)}),e.jsx("button",{onClick:s=>{s.stopPropagation(),r(!d),x(a)},style:{width:"28px",height:"28px",borderRadius:"8px",background:d?"conic-gradient(red, yellow, lime, aqua, blue, magenta, red)":"rgba(255,255,255,0.1)",border:d?"2px solid white":"1px dashed rgba(255,255,255,0.4)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:i.textMuted,transition:"all 0.15s ease"},title:"Scegli colore personalizzato",children:!d&&e.jsx(le,{size:16})})]}),d&&e.jsxs("div",{style:{marginTop:"12px",display:"flex",flexDirection:"column",alignItems:"center",gap:"12px"},children:[e.jsxs("div",{ref:h,onMouseDown:f,onTouchStart:$,onTouchMove:b,onTouchEnd:c,onClick:s=>s.stopPropagation(),style:{width:"120px",height:"120px",borderRadius:"50%",background:"conic-gradient(red, yellow, lime, aqua, blue, magenta, red)",position:"relative",cursor:"crosshair",touchAction:"none",userSelect:"none",boxShadow:"0 4px 16px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, white 0%, transparent 70%)"}}),e.jsx("div",{style:{position:"absolute",left:`calc(50% + ${Math.cos(E)*z}px)`,top:`calc(50% + ${Math.sin(E)*z}px)`,transform:"translate(-50%, -50%)",width:"16px",height:"16px",borderRadius:"50%",background:`rgb(${n.r}, ${n.g}, ${n.b})`,border:"3px solid white",boxShadow:"0 2px 8px rgba(0,0,0,0.4)",pointerEvents:"none"}})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"8px",background:`rgb(${n.r}, ${n.g}, ${n.b})`,border:"2px solid white",boxShadow:`0 0 12px rgb(${n.r}, ${n.g}, ${n.b})`}}),e.jsx("button",{onClick:s=>{s.stopPropagation(),j(n),localStorage.setItem(F,JSON.stringify(n)),t(n),r(!1)},style:{padding:"6px 16px",borderRadius:"8px",fontSize:"11px",fontWeight:600,background:i.accent,color:"#fff",border:"none",cursor:"pointer"},children:"OK"}),e.jsx("button",{onClick:s=>{s.stopPropagation(),r(!1)},style:{padding:"6px 12px",borderRadius:"8px",fontSize:"11px",fontWeight:600,background:"rgba(255,255,255,0.1)",color:i.textMuted,border:"1px solid rgba(255,255,255,0.2)",cursor:"pointer"},children:"Annulla"})]})]})]})},fe=({value:a,onChange:t,colors:i})=>e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"11px",color:i.textMuted,fontWeight:500,display:"block",marginBottom:"8px"},children:"Effetto"}),e.jsx("div",{style:{display:"flex",gap:"6px",flexWrap:"wrap"},children:ue.map(d=>{const r=d.id===a;return e.jsxs("button",{onClick:x=>{x.stopPropagation(),t(d.id)},disabled:!1,title:void 0,style:{padding:"6px 10px",borderRadius:"8px",fontSize:"10px",fontWeight:600,background:r?i.accent:"rgba(255,255,255,0.1)",color:r?"#fff":i.textMuted,border:r?`1px solid ${i.accent}`:"1px solid rgba(255,255,255,0.15)",cursor:"pointer",transition:"all 0.2s ease",opacity:1},children:[d.name,""]},d.id)})})]}),be=({onApply:a,colors:t})=>{const[i,d]=o.useState(()=>{try{const l=localStorage.getItem(H);if(l){const c=JSON.parse(l);if(Array.isArray(c)&&c.length===3)return c}}catch{}return[{r:255,g:0,b:0},{r:0,g:255,b:0},{r:0,g:0,b:255}]}),[r,n]=o.useState(null),x=o.useRef(null),p=o.useRef(!1),h=o.useCallback((l,c)=>{d(f=>{const $=[...f];return $[l]=c,$})},[]),m=o.useCallback((l,c)=>{if(!x.current)return{r:255,g:0,b:0};const f=x.current.getBoundingClientRect(),$=f.width/2,b=f.height/2,w=l-f.left-$,E=c-f.top-b,z=Math.min($,b);let s=Math.atan2(E,w)*(180/Math.PI)+90;s<0&&(s+=360);const S=Math.min(Math.sqrt(w*w+E*E),z)/z*100;return K(s,S,50)},[]),k=o.useCallback((l,c)=>{if(r===null)return;p.current=!0;const f=m(l,c);h(r,f)},[r,m,h]),j=o.useCallback((l,c)=>{if(!p.current||r===null)return;const f=m(l,c);h(r,f)},[r,m,h]),u=o.useCallback(()=>{p.current=!1},[]),y=o.useCallback(l=>{l.preventDefault(),l.stopPropagation(),k(l.clientX,l.clientY);const c=$=>{$.preventDefault(),j($.clientX,$.clientY)},f=()=>{u(),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",f)};document.addEventListener("mousemove",c),document.addEventListener("mouseup",f)},[k,j,u]),M=o.useCallback(l=>{l.stopPropagation(),k(l.touches[0].clientX,l.touches[0].clientY)},[k]),_=o.useCallback(l=>{j(l.touches[0].clientX,l.touches[0].clientY)},[j]),R=o.useCallback(()=>{localStorage.setItem(H,JSON.stringify(i)),a(i)},[i,a]),P=l=>G(l.r,l.g,l.b);return e.jsxs("div",{style:{marginTop:"12px"},children:[e.jsx("span",{style:{fontSize:"11px",color:t.textMuted,fontWeight:500,display:"block",marginBottom:"8px"},children:"Colori Custom Rainbow"}),e.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"12px",justifyContent:"center"},children:i.map((l,c)=>e.jsx("button",{onClick:f=>{f.stopPropagation(),n(r===c?null:c)},style:{width:"40px",height:"40px",borderRadius:"10px",background:`rgb(${l.r}, ${l.g}, ${l.b})`,border:r===c?"3px solid white":"2px solid rgba(255,255,255,0.3)",cursor:"pointer",boxShadow:r===c?`0 0 12px rgb(${l.r}, ${l.g}, ${l.b})`:"none",transition:"all 0.15s ease",position:"relative"},children:e.jsx("span",{style:{position:"absolute",bottom:"-16px",left:"50%",transform:"translateX(-50%)",fontSize:"9px",color:t.textMuted,whiteSpace:"nowrap"},children:c+1})},c))}),r!==null&&e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",marginTop:"20px"},children:e.jsxs("div",{ref:x,onMouseDown:y,onTouchStart:M,onTouchMove:_,onTouchEnd:u,onClick:l=>l.stopPropagation(),style:{width:"100px",height:"100px",borderRadius:"50%",background:"conic-gradient(red, yellow, lime, aqua, blue, magenta, red)",position:"relative",cursor:"crosshair",touchAction:"none",userSelect:"none",boxShadow:"0 4px 16px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{position:"absolute",inset:0,borderRadius:"50%",background:"radial-gradient(circle, white 0%, transparent 70%)"}}),(()=>{const l=P(i[r]),c=(l.h-90)*(Math.PI/180),f=l.s/100*40;return e.jsx("div",{style:{position:"absolute",left:`calc(50% + ${Math.cos(c)*f}px)`,top:`calc(50% + ${Math.sin(c)*f}px)`,transform:"translate(-50%, -50%)",width:"14px",height:"14px",borderRadius:"50%",background:`rgb(${i[r].r}, ${i[r].g}, ${i[r].b})`,border:"2px solid white",boxShadow:"0 2px 8px rgba(0,0,0,0.4)",pointerEvents:"none"}})})()]})}),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"16px"},children:e.jsx("button",{onClick:l=>{l.stopPropagation(),R()},style:{padding:"8px 24px",borderRadius:"10px",fontSize:"12px",fontWeight:600,background:t.accent,color:"#fff",border:"none",cursor:"pointer",boxShadow:`0 4px 12px ${t.accent}50`},children:"Applica Custom Rainbow"})})]})},me=({value:a,onChange:t,colors:i})=>e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"11px",color:i.textMuted,fontWeight:500},children:"VelocitÃ "}),e.jsxs("span",{style:{fontSize:"11px",color:i.textPrimary,fontWeight:600},children:[Math.round(a/255*100),"%"]})]}),e.jsx("input",{type:"range",min:"1",max:"255",value:a,onChange:d=>t(parseInt(d.target.value)),onClick:d=>d.stopPropagation(),style:{width:"100%",height:"6px",borderRadius:"3px",appearance:"none",background:`linear-gradient(to right, rgba(50,50,50,0.8), ${i.accent})`,cursor:"pointer",outline:"none"}})]}),ye=({onChange:a,colors:t})=>{const[i,d]=o.useState(""),[r,n]=o.useState(""),x=()=>{if(!i.trim())return;const p=parseInt(i);if(isNaN(p)||p<1||p>300){n("1-300");return}n(""),a(p),d("")};return e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"11px",color:t.textMuted,fontWeight:500,display:"block",marginBottom:"8px"},children:"Numero LED (1-300)"}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsx("input",{type:"number",min:"1",max:"300",value:i,onChange:p=>{d(p.target.value),n("")},onClick:p=>p.stopPropagation(),onKeyDown:p=>{p.key==="Enter"&&x()},placeholder:"es. 30",style:{flex:1,padding:"8px 12px",borderRadius:"8px",fontSize:"12px",background:"rgba(255,255,255,0.1)",color:t.textPrimary,border:r?"1px solid #ef4444":"1px solid rgba(255,255,255,0.15)",outline:"none"}}),e.jsx("button",{onClick:p=>{p.stopPropagation(),x()},style:{padding:"8px 16px",borderRadius:"8px",fontSize:"11px",fontWeight:600,background:t.accent,color:"#fff",border:"none",cursor:"pointer"},children:"Applica"})]}),r&&e.jsx("span",{style:{fontSize:"10px",color:"#ef4444",marginTop:"4px",display:"block"},children:r})]})},we=({isOpen:a,onClose:t,nome:i,ledColor:d,ledBrightness:r,ledEffect:n,ledSpeed:x,onBrightnessChange:p,onColorChange:h,onEffectChange:m,onSpeedChange:k,onNumLedsChange:j,onCustomEffect:u,colors:y,rgbString:M})=>{const[_,R]=o.useState(!1);if(o.useEffect(()=>{n===6&&R(!0)},[n]),o.useEffect(()=>{a||R(!1)},[a]),!a)return null;const P=f=>{R(f===6),m==null||m(f)},l=f=>{u==null||u(f)},c=e.jsx(de,{children:a&&e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"20px"},children:e.jsxs(N.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:f=>f.stopPropagation(),style:{background:y.bgCard,borderRadius:"24px",border:`1px solid ${y.border}`,boxShadow:`0 20px 60px rgba(0,0,0,0.5), 0 0 40px ${M}30`,width:"100%",maxWidth:"340px",maxHeight:"90vh",overflow:"auto",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:`1px solid ${y.border}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"12px",background:"rgba(30, 30, 30, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:`0 4px 12px ${M}40`,border:"1px solid rgba(100, 100, 100, 0.2)"},children:e.jsx(J,{effect:n,color:d,size:22,isOn:!0})}),e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:y.textPrimary,margin:0},children:i}),e.jsx("p",{style:{fontSize:"11px",color:y.textMuted,margin:"2px 0 0 0"},children:"Controlli LED"})]})]}),e.jsx("button",{onClick:t,style:{width:"32px",height:"32px",borderRadius:"10px",background:"rgba(255,255,255,0.1)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:y.textMuted},children:e.jsx(ie,{size:20})})]}),e.jsxs("div",{style:{padding:"20px",display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsx(he,{value:r,onChange:p,color:M,effect:n,colors:y}),e.jsx(ge,{color:d,onChange:h,colors:y}),m&&e.jsx(fe,{value:n,onChange:P,colors:y}),_&&u&&e.jsx(be,{onApply:l,colors:y}),k&&n!==0&&e.jsx(me,{value:x,onChange:k,colors:y}),j&&e.jsx(ye,{onChange:j,colors:y})]})]})})});return ae.createPortal(c,document.body)},ve=({nome:a,isOn:t,onToggle:i,deviceType:d="relay",isLoading:r=!1,bloccato:n=!1,canControl:x=!0,canViewState:p=!0,ledColor:h={r:255,g:255,b:255},ledBrightness:m=255,ledEffect:k=0,ledSpeed:j=128,onLedChange:u,onLedEffectChange:y,onLedSpeedChange:M,onLedNumLedsChange:_,onLedCustomEffect:R,temperature:P,humidity:l,variant:c="compact",showDelete:f=!1,onDelete:$})=>{const{colors:b,modeColors:w}=Q(),[E,z]=o.useState(!1),s=o.useMemo(()=>{const C=(d||"relay").toLowerCase();return C==="omniapi_led"||C==="led"||C==="led_strip"?"led":C==="sensor"?"sensor":"relay"},[d]),v=s==="led",S=s==="sensor",L=n||r||!x,g=o.useMemo(()=>({...w,accent:b.accent,accentLight:b.accentLight,accentDark:b.accentDark,border:`rgba(${pe(b.accent)}, 0.15)`}),[b,w]),W=o.useMemo(()=>`rgb(${h.r}, ${h.g}, ${h.b})`,[h]),I=g.accent,A=o.useCallback(C=>{u==null||u(h,C)},[h,u]),T=o.useCallback(C=>{u==null||u(C,m)},[m,u]),B=c==="mini"?"8px":c==="compact"?"12px":"16px",D=c==="mini"?16:c==="compact"?18:20,Y=c==="mini"?"12px":c==="compact"?"13px":"14px",O=c==="mini"?"9px":c==="compact"?"10px":"11px";return S?e.jsxs("div",{style:{padding:B,background:g.bgCardLit,border:`1px solid ${g.border}`,borderRadius:c==="mini"?"16px":"20px",boxShadow:g.cardShadowLit,position:"relative",overflow:"hidden",width:"100%"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:"25%",right:"25%",height:"1px",background:`linear-gradient(90deg, transparent, ${g.accentLight}33, transparent)`}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"8px"},children:[e.jsx("div",{style:{padding:"8px",background:`${g.accent}15`,borderRadius:"12px",flexShrink:0},children:e.jsx(V,{size:D,style:{color:g.accent}})}),e.jsx("span",{style:{fontSize:Y,fontWeight:600,color:g.textPrimary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1},children:a||"Sensore"})]}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[P!==void 0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(V,{size:14,style:{color:"#f59e0b"}}),e.jsxs("span",{style:{fontSize:"13px",fontWeight:600,color:g.textPrimary},children:[P.toFixed(1),"Â°C"]})]}),l!==void 0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(ee,{size:14,style:{color:"#3b82f6"}}),e.jsxs("span",{style:{fontSize:"13px",fontWeight:600,color:g.textPrimary},children:[l.toFixed(0),"%"]})]})]})]}):e.jsxs(N.div,{style:{background:n?g.bgCardLit:t?`linear-gradient(165deg, ${I}12, ${g.bgCard})`:g.bgCardLit,border:`1px solid ${n?"rgba(100, 100, 100, 0.3)":t?I:g.border}`,borderRadius:c==="mini"?"16px":"20px",boxShadow:n?"none":t?`0 4px 20px ${I}20, ${g.cardShadow}`:g.cardShadowLit,opacity:n?.6:1,position:"relative",overflow:"hidden",width:"100%"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:v?"15%":"25%",right:v?"15%":"25%",height:v&&t?"2px":"1px",background:t?`linear-gradient(90deg, transparent, ${I}, transparent)`:`linear-gradient(90deg, transparent, ${g.accentLight}33, transparent)`}}),t&&!n&&e.jsx("div",{style:{position:"absolute",top:"-32px",right:"-32px",width:"100px",height:"100px",borderRadius:"50%",filter:"blur(32px)",opacity:.3,background:`radial-gradient(circle, ${I}, transparent)`,pointerEvents:"none"}}),e.jsxs(N.button,{onClick:n?void 0:i,disabled:L,style:{width:"100%",padding:B,background:"transparent",border:"none",cursor:n?"not-allowed":"pointer",textAlign:"left"},whileTap:n?void 0:{scale:.98},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:c==="mini"?"4px":"8px"},children:[e.jsx("div",{style:{padding:c==="mini"?"6px":"8px",background:n?"rgba(100, 100, 100, 0.15)":t?v?"rgba(30, 30, 30, 0.6)":`linear-gradient(145deg, ${g.accent}30, ${g.accent}15)`:`${g.textMuted}10`,borderRadius:c==="mini"?"10px":"14px",boxShadow:t&&!n?`0 2px 8px ${I}40`:"none",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center"},children:r?e.jsx(te,{size:D,className:"animate-spin",style:{color:v&&t?"#fff":g.accent}}):n?e.jsx(ne,{size:D,style:{color:"rgba(150, 150, 150, 0.7)"}}):v?e.jsx(J,{effect:k,color:h,size:D,isOn:t}):e.jsx(oe,{size:D,style:{color:t?g.accentLight:g.textMuted,filter:t?`drop-shadow(0 0 4px ${g.accent})`:"none"}})}),p?e.jsx(ce,{isOn:t,visualOnly:!0,size:c==="mini"?"sm":"md"}):e.jsx("div",{style:{width:c==="mini"?"32px":"40px",height:c==="mini"?"18px":"22px",borderRadius:"12px",background:"rgba(100, 100, 100, 0.3)",opacity:.5}})]}),e.jsx("h3",{style:{fontSize:Y,fontWeight:600,color:n?"rgba(150, 150, 150, 0.8)":g.textPrimary,margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"},children:a||"Dispositivo"}),e.jsx("p",{style:{fontSize:O,fontWeight:500,color:n||!x?"rgba(239, 68, 68, 0.7)":g.textMuted,margin:"2px 0 0 0"},children:n?"Bloccato":x?p?v&&t?`${Math.round(m/255*100)}% luminositÃ `:t?"Acceso":"Spento":"---":"Non autorizzato"})]}),v&&t&&!n&&x&&c!=="mini"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:C=>{C.stopPropagation(),z(!0)},style:{position:"absolute",bottom:"8px",right:"8px",width:"28px",height:"28px",borderRadius:"8px",background:`${W}30`,border:`1px solid ${W}50`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:g.textPrimary,opacity:.8,transition:"all 0.2s ease"},onMouseEnter:C=>{C.currentTarget.style.opacity="1"},onMouseLeave:C=>{C.currentTarget.style.opacity="0.8"},children:e.jsx(re,{size:14})}),e.jsx(we,{isOpen:E,onClose:()=>z(!1),nome:a,ledColor:h,ledBrightness:m,ledEffect:k,ledSpeed:j,onBrightnessChange:A,onColorChange:T,onEffectChange:y,onSpeedChange:M,onNumLedsChange:_,onCustomEffect:R,colors:g,rgbString:W})]}),f&&$&&e.jsx("button",{onClick:C=>{C.stopPropagation(),$()},style:{position:"absolute",top:"8px",right:"8px",width:"28px",height:"28px",borderRadius:"8px",background:"rgba(239, 68, 68, 0.1)",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:g.error||"#ef4444",opacity:.7,transition:"all 0.2s ease"},onMouseEnter:C=>{C.currentTarget.style.opacity="1"},onMouseLeave:C=>{C.currentTarget.style.opacity="0.7"},children:e.jsx(se,{size:14})})]})},Re=o.memo(ve);export{Re as U,Me as u};
