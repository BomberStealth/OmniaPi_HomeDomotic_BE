import{x as te,w as oe,a as ne,u as re,X as se,r as a,p as k,j as e,O as ae,g as le,e as B,m as R,i as H,aM as E,aN as O,a0 as de,a8 as U,ax as ce,Z as pe,b as xe,H as h}from"./index-B7WG_kHJ-1769026461592.js";import{L as N}from"./Layout-BnB1agDJ-1769026461592.js";import{T as F}from"./Toggle-B6i1zhXp-1769026461592.js";import{m as s}from"./motion-DSM7Rpg2-1769026461592.js";import{A as ge}from"./index-yirOBEcN-1769026461592.js";import"./useTranslation-CnXjuBvM-1769026461592.js";import"./responsive-BJrBEfWo-1769026461592.js";import"./omniapiApi-DDnppdd_-1769026461592.js";function G(c){const p=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(c);return p?`${parseInt(p[1],16)}, ${parseInt(p[2],16)}, ${parseInt(p[3],16)}`:"106, 212, 160"}const V={hidden:{opacity:0,y:30,scale:.95},show:{opacity:1,y:0,scale:1,transition:{duration:.4,ease:"easeOut"}}},ue={hidden:{},show:{transition:{staggerChildren:.1}}},we=()=>{const{colors:c,modeColors:p}=te(),{impiantoCorrente:n}=oe(),{user:l}=ne(),$=re(),y=(l==null?void 0:l.ruolo)===se.ADMIN||(n==null?void 0:n.utente_id)===(l==null?void 0:l.id)||(n==null?void 0:n.installatore_id)===(l==null?void 0:l.id),[q,I]=a.useState(!0),[C,X]=a.useState([]),[f,_]=a.useState(null),[Z,b]=a.useState(!1),[d,L]=a.useState(""),[m,J]=a.useState("ospite"),[v,P]=a.useState({puo_controllare_dispositivi:!0,puo_vedere_stato:!0}),[x,M]=a.useState(!1),i={...p,accent:c.accent,accentLight:c.accentLight,accentDark:c.accentDark,border:`rgba(${G(c.accent)}, 0.15)`,borderHover:`rgba(${G(c.accent)}, 0.35)`},W={background:i.bgCardLit,border:`1px solid ${i.border}`,borderRadius:"20px",boxShadow:i.cardShadowLit,position:"relative",overflow:"hidden"},K={position:"absolute",top:0,left:"25%",right:"25%",height:"1px",background:`linear-gradient(90deg, transparent, ${i.accentLight}4D, transparent)`,pointerEvents:"none"},j=a.useCallback(async()=>{var t;if(!(n!=null&&n.id)){I(!1);return}try{const{data:o}=await k.get(`/api/impianti/${n.id}/condivisioni`);X(o.data||[])}catch(o){((t=o.response)==null?void 0:t.status)!==403&&console.error("Error loading condivisioni:",o)}finally{I(!1)}},[n==null?void 0:n.id]);if(a.useEffect(()=>{j()},[j]),!n)return e.jsx(N,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"48px 16px",gap:"16px"},children:[e.jsx(ae,{size:48,style:{color:i.textMuted,opacity:.5}}),e.jsx("p",{style:{color:i.textSecondary,textAlign:"center"},children:"Seleziona un impianto per accedere alle condivisioni"}),e.jsx(s.button,{onClick:()=>$("/dashboard"),style:{padding:"12px 24px",borderRadius:"12px",background:`${i.accent}20`,border:`1px solid ${i.accent}50`,color:i.accent,fontWeight:600,cursor:"pointer"},whileHover:{scale:1.02},whileTap:{scale:.98},children:"Vai alla Dashboard"})]})});const Q=async()=>{var t,o;if(!d.trim()){h.error("Inserisci un'email");return}M(!0);try{await k.post("/api/condivisioni/invita",{impiantoId:n.id,email:d.trim(),ruolo:m,permessi:v}),h.success("Invito inviato!"),b(!1),L(""),j()}catch(g){h.error(((o=(t=g.response)==null?void 0:t.data)==null?void 0:o.error)||"Errore invio invito")}finally{M(!1)}},D=async t=>{var o,g;if(confirm("Rimuovere questo utente dall'impianto?")){_(t);try{await k.delete(`/api/condivisioni/${t}`),h.success("Accesso rimosso"),j()}catch(w){h.error(((g=(o=w.response)==null?void 0:o.data)==null?void 0:g.error)||"Errore")}finally{_(null)}}},Y=t=>C.filter(o=>o.ruolo_condivisione===t&&o.stato==="accettato"),ee=t=>C.filter(o=>o.ruolo_condivisione===t&&o.stato==="pendente"),T=t=>{switch(t){case"installatore":return{bg:`${i.warning}20`,color:i.warning,border:`${i.warning}50`,icon:H};case"proprietario":return{bg:`${i.accent}20`,color:i.accent,border:`${i.accent}50`,icon:E};default:return{bg:`${i.textMuted}20`,color:i.textSecondary,border:`${i.textMuted}50`,icon:O}}},S=({ruolo:t,title:o,description:g,icon:w,iconBg:ie})=>{const z=Y(t),A=ee(t),u=T(t);return e.jsxs(s.div,{variants:V,style:{...W,padding:"16px"},children:[e.jsx("div",{style:K}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"12px"},children:[e.jsx("div",{style:{padding:"10px",borderRadius:"12px",background:ie},children:e.jsx(w,{size:20,style:{color:u.color}})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:i.textPrimary,margin:0},children:o}),e.jsx("p",{style:{fontSize:"12px",color:i.textMuted,margin:"2px 0 0 0"},children:g})]}),e.jsx("span",{style:{padding:"4px 10px",borderRadius:"8px",background:u.bg,color:u.color,fontSize:"12px",fontWeight:600},children:z.length})]}),z.length===0&&A.length===0?e.jsx("div",{style:{padding:"16px",borderRadius:"12px",background:i.bgCard,textAlign:"center"},children:e.jsxs("p",{style:{color:i.textMuted,fontSize:"13px",margin:0},children:["Nessun ",t," condiviso"]})}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[z.map(r=>e.jsxs("div",{style:{padding:"12px",borderRadius:"12px",background:i.bgCard,border:`1px solid ${i.border}`,display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:`${u.color}15`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(ce,{size:18,style:{color:u.color}})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("p",{style:{fontSize:"14px",fontWeight:500,color:i.textPrimary,margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.utente_nome?`${r.utente_nome} ${r.utente_cognome||""}`.trim():r.email_invitato}),e.jsx("p",{style:{fontSize:"11px",color:i.textMuted,margin:"2px 0 0 0"},children:r.puo_controllare_dispositivi?"Controllo dispositivi":"Solo visualizzazione"})]}),y&&e.jsx(s.button,{onClick:()=>D(r.id),disabled:f===r.id,style:{padding:"8px",borderRadius:"10px",background:"transparent",border:"none",cursor:f===r.id?"not-allowed":"pointer",opacity:f===r.id?.5:1},whileHover:{background:`${i.error}20`},whileTap:{scale:.95},children:f===r.id?e.jsx(R,{size:16,style:{color:i.error,animation:"spin 1s linear infinite"}}):e.jsx(pe,{size:16,style:{color:i.error}})})]},r.id)),A.map(r=>e.jsxs("div",{style:{padding:"12px",borderRadius:"12px",background:i.bgCard,border:`1px dashed ${i.warning}50`,display:"flex",alignItems:"center",gap:"12px",opacity:.8},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:`${i.warning}15`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(xe,{size:18,style:{color:i.warning}})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("p",{style:{fontSize:"14px",fontWeight:500,color:i.textPrimary,margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.email_invitato}),e.jsx("p",{style:{fontSize:"11px",color:i.warning,margin:"2px 0 0 0"},children:"In attesa di accettazione"})]}),y&&e.jsx(s.button,{onClick:()=>D(r.id),style:{padding:"8px",borderRadius:"10px",background:"transparent",border:"none",cursor:"pointer"},whileHover:{background:`${i.error}20`},children:e.jsx(U,{size:16,style:{color:i.textMuted}})})]},r.id))]})]})};return e.jsxs(N,{children:[e.jsxs(s.div,{initial:"hidden",animate:"show",variants:ue,style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(s.button,{onClick:()=>$(-1),style:{padding:"10px",borderRadius:"12px",background:i.bgCard,border:`1px solid ${i.border}`,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(le,{size:20,color:i.textSecondary})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h1",{style:{fontSize:"20px",fontWeight:700,color:i.textPrimary,margin:0},children:"Gestione Condivisioni"}),e.jsx("p",{style:{fontSize:"12px",color:i.textMuted,margin:"2px 0 0 0"},children:n.nome})]}),y&&e.jsxs(s.button,{onClick:()=>b(!0),style:{display:"flex",alignItems:"center",gap:"6px",padding:"10px 16px",borderRadius:"12px",background:`linear-gradient(135deg, ${i.accent}, ${i.accentDark})`,border:"none",color:"#fff",fontSize:"14px",fontWeight:600,cursor:"pointer"},whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(B,{size:18}),"Invita"]})]}),q?e.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"48px"},children:e.jsx(R,{size:32,color:i.accent,style:{animation:"spin 1s linear infinite"}})}):e.jsxs(e.Fragment,{children:[e.jsx(S,{ruolo:"installatore",title:"Installatori",description:"Possono configurare dispositivi e stanze",icon:H,iconBg:`${i.warning}15`}),e.jsx(S,{ruolo:"proprietario",title:"Proprietari",description:"Possono gestire l'impianto e i dispositivi",icon:E,iconBg:`${i.accent}15`}),e.jsx(S,{ruolo:"ospite",title:"Ospiti",description:"Accesso limitato in base ai permessi",icon:O,iconBg:`${i.textMuted}15`})]}),!y&&e.jsx(s.div,{variants:V,style:{...W,padding:"16px",background:`${i.info}10`,border:`1px solid ${i.info}30`},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(de,{size:24,style:{color:i.info}}),e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"14px",color:i.textPrimary,margin:0},children:"Accesso in sola lettura"}),e.jsx("p",{style:{fontSize:"12px",color:i.textMuted,margin:"4px 0 0 0"},children:"Solo il proprietario o l'installatore originale possono gestire le condivisioni"})]})]})})]}),e.jsx(ge,{children:Z&&e.jsxs(e.Fragment,{children:[e.jsx(s.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",zIndex:100},onClick:()=>b(!1)}),e.jsxs(s.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},style:{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"calc(100% - 32px)",maxWidth:"400px",background:i.bgCardLit,borderRadius:"20px",padding:"20px",zIndex:101,border:`1px solid ${i.border}`,boxShadow:i.cardShadowLit},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:i.textPrimary,margin:0},children:"Invita Utente"}),e.jsx(s.button,{onClick:()=>b(!1),style:{padding:"8px",borderRadius:"10px",background:"transparent",border:"none",cursor:"pointer"},whileHover:{background:`${i.textMuted}20`},children:e.jsx(U,{size:20,color:i.textMuted})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"12px",fontWeight:500,color:i.textSecondary,display:"block",marginBottom:"6px"},children:"Email"}),e.jsx("input",{type:"email",value:d,onChange:t=>L(t.target.value),placeholder:"email@esempio.com",style:{width:"100%",padding:"12px",borderRadius:"12px",background:i.bgCard,border:`1px solid ${i.border}`,color:i.textPrimary,fontSize:"14px",outline:"none",boxSizing:"border-box"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"12px",fontWeight:500,color:i.textSecondary,display:"block",marginBottom:"6px"},children:"Ruolo"}),e.jsx("div",{style:{display:"flex",gap:"8px"},children:["ospite","proprietario","installatore"].map(t=>{const o=T(t);return e.jsx(s.button,{onClick:()=>J(t),style:{flex:1,padding:"10px 8px",borderRadius:"10px",background:m===t?o.bg:i.bgCard,border:`1px solid ${m===t?o.color:i.border}`,color:m===t?o.color:i.textSecondary,fontSize:"12px",fontWeight:500,cursor:"pointer",textTransform:"capitalize"},whileHover:{scale:1.02},whileTap:{scale:.98},children:t},t)})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderRadius:"10px",background:i.bgCard,border:`1px solid ${i.border}`},children:[e.jsx("span",{style:{fontSize:"13px",color:i.textPrimary},children:"Può controllare dispositivi"}),e.jsx(F,{isOn:v.puo_controllare_dispositivi,onToggle:()=>P(t=>({...t,puo_controllare_dispositivi:!t.puo_controllare_dispositivi,puo_vedere_stato:t.puo_controllare_dispositivi?t.puo_vedere_stato:!0})),size:"sm"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",borderRadius:"10px",background:i.bgCard,border:`1px solid ${i.border}`},children:[e.jsx("span",{style:{fontSize:"13px",color:i.textPrimary},children:"Può vedere stato"}),e.jsx(F,{isOn:v.puo_vedere_stato,onToggle:()=>P(t=>({...t,puo_vedere_stato:!t.puo_vedere_stato})),size:"sm",disabled:v.puo_controllare_dispositivi})]})]}),e.jsx(s.button,{onClick:Q,disabled:x||!d.trim(),style:{width:"100%",padding:"14px",borderRadius:"12px",background:`linear-gradient(135deg, ${i.accent}, ${i.accentDark})`,border:"none",color:"#fff",fontSize:"14px",fontWeight:600,cursor:x||!d.trim()?"not-allowed":"pointer",opacity:x||!d.trim()?.6:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},whileHover:!x&&d.trim()?{scale:1.02}:{},whileTap:!x&&d.trim()?{scale:.98}:{},children:x?e.jsx(R,{size:18,style:{animation:"spin 1s linear infinite"}}):e.jsxs(e.Fragment,{children:[e.jsx(B,{size:18}),"Invia Invito"]})})]})]})]})}),e.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]})};export{we as GestioneCondivisioni,we as default};
