import{r as p,j as i,a$ as I,aj as z,z as b,B as u,y as m,aX as $,aV as _,b0 as E,H as j,m as M,a2 as L,a9 as A,aw as O,K as W}from"./index-B7WG_kHJ-1769026461592.js";import{o as f}from"./omniapiApi-DDnppdd_-1769026461592.js";import{u as H}from"./useThemeColors-DHOyp60z-1769026461592.js";import{m as g}from"./motion-DSM7Rpg2-1769026461592.js";const P={omniapi_led:m,omniapi_led_rgb:m,omniapi_led_rgbw:m,led:m,omniapi_node:u,omniapi_relay_2ch:u,omniapi_relay_4ch:u,relay:u,sensor:b,omniapi_sensor_th:b,omniapi_sensor_motion:b,dimmer:z,omniapi_dimmer:z,tasmota:I},B=({deviceType:r,size:l=20,className:x="",style:n})=>{const o=(r==null?void 0:r.toLowerCase())||"",e=P[o]||$;return i.jsx(e,{size:l,className:x,style:n})},G=p.memo(B),N={sm:{icon:12,font:"10px",gap:"2px"},md:{icon:14,font:"11px",gap:"4px"},lg:{icon:18,font:"13px",gap:"6px"}},F=({online:r=!1,rssi:l,size:x="md",showLabel:n=!0})=>{const o=N[x],e=r?"#22c55e":"#ef4444",y=()=>l?l>=-50?"Ottimo":l>=-60?"Buono":l>=-70?"Discreto":"Debole":null;return i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:o.gap},children:[r?i.jsx(_,{size:o.icon,style:{color:e}}):i.jsx(E,{size:o.icon,style:{color:e}}),n&&i.jsx("span",{style:{fontSize:o.font,color:e,fontWeight:500},children:r?l?y():"Online":"Offline"})]})};p.memo(F);const J=({onDeviceSelected:r,excludeMacs:l=[],showRefreshButton:x=!0,compact:n=!1,onRefreshRef:o})=>{const{colors:e}=H(),[y,w]=p.useState(!0),[C,R]=p.useState([]),[S,v]=p.useState(null),c=p.useCallback(async()=>{w(!0);try{const[s,a]=await Promise.all([f.getNodes().catch(()=>({nodes:[]})),f.getLedDevices().catch(()=>({devices:[]}))]),d=[];s.nodes&&s.nodes.forEach(t=>{d.push({mac:t.mac,device_type:"omniapi_node",online:t.online??!0,rssi:t.rssi,relay1:t.relay1,relay2:t.relay2,version:t.version})}),a.devices&&a.devices.forEach(t=>{d.push({mac:t.mac,device_type:"omniapi_led",online:t.online??!0,power:t.power,r:t.r??255,g:t.g??255,b:t.b??255,brightness:t.brightness??100})}),R(d)}catch(s){console.error("Errore fetch dispositivi:",s),j.error("Errore caricamento")}finally{w(!1)}},[]);p.useEffect(()=>{c()},[c]),p.useEffect(()=>{o&&o(c)},[o,c]);const h=C.filter(s=>!l.includes(s.mac)),k=async(s,a)=>{if(a.stopPropagation(),!S){v(s.mac);try{s.device_type==="omniapi_led"?(await f.sendLedCommand(s.mac,"on"),setTimeout(()=>f.sendLedCommand(s.mac,"off"),500)):await f.testDevice(s.mac),j.success("Test inviato!")}catch{j.error("Errore test")}finally{setTimeout(()=>v(null),2e3)}}},D=s=>{r&&r(s)};return y?i.jsxs("div",{style:{textAlign:"center",padding:n?"24px":"40px"},children:[i.jsx(M,{size:n?28:32,className:"animate-spin",style:{color:e.accent,margin:"0 auto"}}),i.jsx("p",{style:{color:e.textMuted,marginTop:"12px",fontSize:n?"13px":"14px"},children:"Ricerca dispositivi..."})]}):h.length===0?i.jsxs("div",{style:{textAlign:"center",padding:n?"24px":"40px"},children:[i.jsx(_,{size:n?36:48,style:{color:e.textMuted,marginBottom:"12px"}}),i.jsx("p",{style:{fontSize:n?"14px":"15px",color:e.textSecondary,margin:0},children:"Nessun nuovo dispositivo"}),i.jsx("p",{style:{fontSize:n?"12px":"13px",color:e.textMuted,marginTop:"8px"},children:"Accendi i dispositivi OmniaPi e premi Aggiorna"}),x&&i.jsxs(g.button,{onClick:c,style:{marginTop:"16px",padding:"10px 20px",borderRadius:"12px",background:`${e.accent}15`,border:`1px solid ${e.accent}30`,color:e.accent,fontSize:"13px",fontWeight:600,cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"8px"},whileHover:{scale:1.02},whileTap:{scale:.98},children:[i.jsx(L,{size:16}),"Aggiorna"]})]}):i.jsxs("div",{children:[x&&i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[i.jsxs("span",{style:{fontSize:"12px",color:e.textMuted,textTransform:"uppercase",letterSpacing:"0.5px"},children:[h.length," disponibil",h.length===1?"e":"i"]}),i.jsxs(g.button,{onClick:c,style:{padding:"6px 12px",borderRadius:"8px",background:"transparent",border:`1px solid ${e.border}`,color:e.textMuted,fontSize:"11px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},whileHover:{borderColor:e.accent,color:e.accent},whileTap:{scale:.98},children:[i.jsx(L,{size:12}),"Aggiorna"]})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:n?"6px":"8px"},children:h.map(s=>{const a=s.device_type==="omniapi_led",d=a?`rgb(${s.r},${s.g},${s.b})`:e.accent,t=S===s.mac;return i.jsxs(g.div,{style:{padding:n?"10px 12px":"14px",background:e.bgSecondary,borderRadius:n?"12px":"16px",display:"flex",alignItems:"center",justifyContent:"space-between",border:`1px solid ${e.border}`},whileHover:{borderColor:e.accent},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:n?"10px":"12px",flex:1,minWidth:0},children:[a?i.jsx("div",{style:{width:n?"32px":"40px",height:n?"32px":"40px",borderRadius:n?"10px":"12px",background:s.power?d:e.bgCard,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:s.power?`0 0 12px ${d}`:"none",flexShrink:0},children:i.jsx(A,{size:n?16:20,style:{color:s.power?"#fff":e.textMuted}})}):i.jsx("div",{style:{width:n?"32px":"40px",height:n?"32px":"40px",borderRadius:n?"10px":"12px",background:`${e.accent}15`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:i.jsx(u,{size:n?16:20,style:{color:e.accent}})}),i.jsxs("div",{style:{minWidth:0,flex:1},children:[i.jsx("p",{style:{fontSize:n?"13px":"14px",fontWeight:600,color:e.textPrimary,margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a?"LED Strip":"Relay Node"}),i.jsxs("p",{style:{fontSize:n?"10px":"11px",color:e.textMuted,margin:0},children:[s.mac.slice(-8)," • ",s.online?"Online":"Offline",s.rssi&&` • ${s.rssi}dBm`]})]})]}),i.jsxs("div",{style:{display:"flex",gap:n?"6px":"8px",flexShrink:0},children:[i.jsxs(g.button,{onClick:T=>k(s,T),disabled:t,style:{padding:n?"6px 10px":"8px 12px",borderRadius:n?"8px":"10px",background:t?e.accent:"transparent",border:`1px solid ${e.accent}`,color:t?"#fff":e.accent,fontSize:n?"11px":"12px",fontWeight:600,cursor:t?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"4px"},whileHover:t?{}:{background:`${e.accent}15`},whileTap:t?{}:{scale:.98},children:[t?i.jsx(O,{size:12}):null,"TEST"]}),i.jsx(g.button,{onClick:()=>D(s),style:{width:n?"32px":"36px",height:n?"32px":"36px",borderRadius:n?"8px":"10px",background:e.accent,border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},whileHover:{scale:1.05},whileTap:{scale:.95},children:i.jsx(W,{size:n?16:18,style:{color:"#fff"}})})]})]},s.mac)})})]})};export{J as D,G as a};
