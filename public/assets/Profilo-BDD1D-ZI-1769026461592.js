import{a as H,x as U,u as W,r as l,j as e,g as O,ax as Z,b as q,a3 as F,aF as G,Z as J,a8 as Q,d as K,H as r,p as b}from"./index-B7WG_kHJ-1769026461592.js";import{L as V}from"./Layout-BnB1agDJ-1769026461592.js";import{I as C}from"./Input-Bz5_UG-L-1769026461592.js";import{B as f}from"./Button-BLF6EOYE-1769026461592.js";import{m as s}from"./motion-DSM7Rpg2-1769026461592.js";import{A as X}from"./index-yirOBEcN-1769026461592.js";import"./useTranslation-CnXjuBvM-1769026461592.js";import"./responsive-BJrBEfWo-1769026461592.js";import"./omniapiApi-DDnppdd_-1769026461592.js";const Y={bgCardLit:"linear-gradient(165deg, #2a2722 0%, #1e1c18 50%, #1a1816 100%)",textPrimary:"#ffffff",textSecondary:"rgba(255, 255, 255, 0.75)",textMuted:"rgba(255, 255, 255, 0.5)",cardShadowLit:"0 8px 32px rgba(0, 0, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255,255,255,0.06)"};function _(i){const c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return c?`${parseInt(c[1],16)}, ${parseInt(c[2],16)}, ${parseInt(c[3],16)}`:"106, 212, 160"}const ce=()=>{const{user:i,setUser:c}=H(),{colors:h}=U(),j=W(),[y,E]=l.useState((i==null?void 0:i.nome)||""),R=(i==null?void 0:i.email)||"",[v,S]=l.useState(!1),[L,w]=l.useState(!1),[I,z]=l.useState(!1),[A,m]=l.useState(!1),[d,M]=l.useState(""),[p,D]=l.useState(""),t={...Y,accent:h.accent,accentLight:h.accentLight,border:`rgba(${_(h.accent)}, 0.15)`},x={background:t.bgCardLit,border:`1px solid ${t.border}`,borderRadius:"20px",boxShadow:t.cardShadowLit,position:"relative",overflow:"hidden"},u={position:"absolute",top:0,left:"25%",right:"25%",height:"1px",background:`linear-gradient(90deg, transparent, ${t.accentLight}4D, transparent)`,pointerEvents:"none"},N=async()=>{var a,n;if(!y.trim()){r.error("Il nome non puo essere vuoto");return}S(!0);try{const o=await b.put("/api/auth/profile",{nome:y});c(o.data.user),r.success("Profilo aggiornato con successo"),j("/settings")}catch(o){r.error(((n=(a=o.response)==null?void 0:a.data)==null?void 0:n.error)||"Errore durante l'aggiornamento")}finally{S(!1)}},P=async()=>{var a,n;w(!0);try{const o=await b.get("/api/auth/export-data");if(o.data.success){const B=JSON.stringify(o.data.data,null,2),T=new Blob([B],{type:"application/json"}),k=URL.createObjectURL(T),g=document.createElement("a");g.href=k,g.download=`omniapi-dati-${(i==null?void 0:i.email)||"utente"}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(k),r.success("Dati esportati con successo")}}catch(o){r.error(((n=(a=o.response)==null?void 0:a.data)==null?void 0:n.error)||"Errore durante l'esportazione")}finally{w(!1)}},$=async()=>{var a,n;if(p!=="ELIMINA"){r.error("Scrivi ELIMINA per confermare");return}if(!d){r.error("Inserisci la password per confermare");return}z(!0);try{(await b.post("/api/auth/delete-account",{password:d})).data.success&&(r.success("Account eliminato con successo"),localStorage.removeItem("token"),window.location.href="/login")}catch(o){r.error(((n=(a=o.response)==null?void 0:a.data)==null?void 0:n.error)||"Errore durante l'eliminazione")}finally{z(!1)}};return e.jsxs(V,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(s.button,{onClick:()=>j("/settings"),style:{padding:"10px",borderRadius:"12px",background:`${t.accent}15`,border:`1px solid ${t.accent}30`,color:t.accent,cursor:"pointer"},whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(O,{size:20})}),e.jsx("h1",{style:{fontSize:"24px",fontWeight:700,color:t.textPrimary,margin:0},children:"Profilo"})]}),e.jsxs(s.div,{style:{...x,padding:"24px"},children:[e.jsx("div",{style:u}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:`linear-gradient(135deg, ${t.accent}30, ${t.accent}10)`,border:`2px solid ${t.accent}50`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Z,{size:36,style:{color:t.accent}})}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:600,color:t.textPrimary,margin:0},children:(i==null?void 0:i.nome)||"Utente"}),e.jsxs("p",{style:{fontSize:"13px",color:t.textMuted,margin:"4px 0 0 0",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[e.jsx(q,{size:14}),(i==null?void 0:i.email)||"email@example.com"]})]})]})]}),e.jsxs(s.div,{style:{...x,padding:"20px"},children:[e.jsx("div",{style:u}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsx(C,{label:"Nome",value:y,onChange:a=>E(a.target.value),placeholder:"Il tuo nome"}),e.jsxs("div",{children:[e.jsx(C,{label:"Email",type:"email",value:R,disabled:!0,placeholder:"La tua email"}),e.jsx("p",{style:{fontSize:"11px",color:t.textMuted,marginTop:"6px",fontStyle:"italic"},children:"Per cambiare email contatta il supporto"})]}),e.jsxs(f,{variant:"primary",onClick:N,disabled:v,className:"w-full mt-2",children:[e.jsx(F,{size:18,className:"mr-2"}),v?"Salvataggio...":"Salva Modifiche"]})]})]}),e.jsxs(s.div,{style:{...x,padding:"20px"},children:[e.jsx("div",{style:u}),e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:t.textPrimary,marginBottom:"16px"},children:"I miei dati"}),e.jsx("p",{style:{fontSize:"13px",color:t.textMuted,marginBottom:"16px",lineHeight:1.5},children:"Ai sensi del GDPR (Art. 20), puoi esportare tutti i tuoi dati in qualsiasi momento."}),e.jsxs(f,{variant:"secondary",onClick:P,disabled:L,className:"w-full",children:[e.jsx(G,{size:18,className:"mr-2"}),L?"Esportazione...":"Esporta i miei dati"]})]}),e.jsxs(s.div,{style:{...x,padding:"20px",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[e.jsx("div",{style:{...u,background:"linear-gradient(90deg, transparent, rgba(239, 68, 68, 0.3), transparent)"}}),e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"#ef4444",marginBottom:"12px"},children:"Zona pericolosa"}),e.jsx("p",{style:{fontSize:"13px",color:t.textMuted,marginBottom:"16px",lineHeight:1.5},children:"L'eliminazione dell'account e permanente. Tutti i tuoi dati, impianti, dispositivi e scene verranno eliminati definitivamente."}),e.jsxs(s.button,{onClick:()=>m(!0),style:{width:"100%",padding:"12px 16px",background:"transparent",border:"1px solid #dc2626",borderRadius:"8px",color:"#dc2626",fontWeight:500,fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s ease"},whileHover:{background:"#dc2626",color:"#ffffff"},whileTap:{scale:.98},children:[e.jsx(J,{size:18}),"Elimina il mio account"]})]})]}),e.jsx(X,{children:A&&e.jsx(s.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",padding:"16px",zIndex:100},onClick:()=>m(!1),children:e.jsxs(s.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},style:{...x,maxWidth:"400px",width:"100%",padding:"24px"},onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:600,color:"#ef4444",margin:0},children:"Elimina Account"}),e.jsx("button",{onClick:()=>m(!1),style:{background:"transparent",border:"none",color:t.textMuted,cursor:"pointer",padding:"4px"},children:e.jsx(Q,{size:24})})]}),e.jsx("div",{style:{padding:"12px",borderRadius:"12px",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",marginBottom:"16px"},children:e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"flex-start"},children:[e.jsx(K,{size:20,style:{color:"#ef4444",flexShrink:0}}),e.jsx("p",{style:{fontSize:"13px",color:"#ef4444",margin:0,lineHeight:1.5},children:"Questa azione e irreversibile. Tutti i tuoi dati verranno eliminati permanentemente."})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{fontSize:"13px",color:t.textMuted,display:"block",marginBottom:"6px"},children:["Scrivi ",e.jsx("strong",{style:{color:"#ef4444"},children:"ELIMINA"})," per confermare"]}),e.jsx("input",{type:"text",value:p,onChange:a=>D(a.target.value),placeholder:"ELIMINA",style:{width:"100%",padding:"12px",borderRadius:"12px",background:"rgba(255, 255, 255, 0.05)",border:`1px solid ${t.border}`,color:t.textPrimary,fontSize:"14px",outline:"none"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"13px",color:t.textMuted,display:"block",marginBottom:"6px"},children:"Inserisci la tua password"}),e.jsx("input",{type:"password",value:d,onChange:a=>M(a.target.value),placeholder:"Password",style:{width:"100%",padding:"12px",borderRadius:"12px",background:"rgba(255, 255, 255, 0.05)",border:`1px solid ${t.border}`,color:t.textPrimary,fontSize:"14px",outline:"none"}})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"8px"},children:[e.jsx(f,{variant:"secondary",onClick:()=>m(!1),className:"flex-1",children:"Annulla"}),e.jsx(f,{variant:"secondary",onClick:$,disabled:I||p!=="ELIMINA"||!d,className:"flex-1",style:{background:p==="ELIMINA"&&d?"rgba(239, 68, 68, 0.2)":"rgba(239, 68, 68, 0.05)",border:"1px solid rgba(239, 68, 68, 0.5)",color:"#ef4444",opacity:p!=="ELIMINA"||!d?.5:1},children:I?"Eliminazione...":"Elimina"})]})]})]})})})]})};export{ce as Profilo};
