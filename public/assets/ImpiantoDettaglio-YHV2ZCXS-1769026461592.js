import{r as m,j as e,y as A,P as E,K as p,Q as u,S as T,T as D,U as I,E as R,z as P,V as M,W as O,u as W,a as B,J as H,X as C,g as Q,Y as J,Z as K,h as V,_ as v,$ as X}from"./index-B7WG_kHJ-1769026461592.js";import{L}from"./Layout-BnB1agDJ-1769026461592.js";import{C as f}from"./Card-tMATpRxV-1769026461592.js";import{B as g}from"./Button-BLF6EOYE-1769026461592.js";import{M as Y}from"./Modal-BJmk3CCX-1769026461592.js";import"./motion-DSM7Rpg2-1769026461592.js";import"./index-yirOBEcN-1769026461592.js";import"./useTranslation-CnXjuBvM-1769026461592.js";import"./responsive-BJrBEfWo-1769026461592.js";import"./omniapiApi-DDnppdd_-1769026461592.js";const Z=({dispositivo:r,onUpdate:a})=>{const s=r.configurazione,[t,x]=m.useState(s.livello_corrente||100),o=async()=>{try{await u.control(r.id,{accesa:!s.accesa,newConfig:{...s,accesa:!s.accesa}}),a==null||a()}catch(n){console.error("Errore toggle luce:",n)}},d=async n=>{if(s.dimmerabile){x(n);try{await u.control(r.id,{livello:n,newConfig:{...s,livello_corrente:n}}),a==null||a()}catch(l){console.error("Errore cambio livello:",l)}}};return e.jsxs(f,{variant:"glass",hover:!0,className:"relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-4 right-4 w-3 h-3 rounded-full ${s.accesa?"bg-warning animate-pulse":"bg-copy-lighter"}`}),e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-3 rounded-xl ${s.accesa?"bg-warning bg-opacity-20":"bg-foreground"}`,children:e.jsx(A,{size:24,className:s.accesa?"text-warning":"text-copy-lighter"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-copy",children:r.nome}),e.jsx("p",{className:"text-xs text-copy-lighter",children:r.stato})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(g,{variant:s.accesa?"primary":"glass",fullWidth:!0,onClick:o,children:s.accesa?"Spegni":"Accendi"}),s.dimmerabile&&s.accesa&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>d(Math.max(0,t-10)),className:"p-2 glass rounded-lg hover:bg-opacity-20",children:e.jsx(E,{size:16})}),e.jsxs("div",{className:"flex-1 glass rounded-lg px-4 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-copy-lighter",children:"IntensitÃ "}),e.jsxs("span",{className:"text-xs text-copy",children:[t,"%"]})]}),e.jsx("div",{className:"w-full h-2 bg-foreground rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-warning transition-all",style:{width:`${t}%`}})})]}),e.jsx("button",{onClick:()=>d(Math.min(100,t+10)),className:"p-2 glass rounded-lg hover:bg-opacity-20",children:e.jsx(p,{size:16})})]})]})]})},q=({dispositivo:r,onUpdate:a})=>{const s=r.configurazione,t=async(x,o)=>{try{await u.control(r.id,{azione:x,posizione:o,newConfig:{...s,in_movimento:x!=="stop",posizione_corrente:o||s.posizione_corrente}}),a==null||a()}catch(d){console.error("Errore controllo tapparella:",d)}};return e.jsxs(f,{variant:"glass",hover:!0,children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 rounded-xl bg-secondary bg-opacity-20",children:e.jsx(T,{size:24,className:"text-secondary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-copy",children:r.nome}),e.jsx("p",{className:"text-xs text-copy-lighter",children:s.in_movimento?"In movimento...":`${s.posizione_corrente}%`})]})]})}),e.jsx("div",{className:"mb-4 glass rounded-lg p-4",children:e.jsxs("div",{className:"relative h-32 bg-foreground rounded-lg overflow-hidden",children:[e.jsx("div",{className:"absolute bottom-0 w-full bg-gradient-to-t from-secondary to-secondary-light transition-all duration-500",style:{height:`${s.posizione_corrente}%`}}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-2xl font-bold text-copy drop-shadow-lg",children:[s.posizione_corrente,"%"]})})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(g,{variant:"glass",size:"sm",onClick:()=>t("apri",100),children:e.jsx(D,{size:20})}),e.jsx(g,{variant:"glass",size:"sm",onClick:()=>t("stop"),children:e.jsx(I,{size:20})}),e.jsx(g,{variant:"glass",size:"sm",onClick:()=>t("chiudi",0),children:e.jsx(R,{size:20})})]})]})},F=({dispositivo:r,onUpdate:a})=>{const s=r.configurazione,[t,x]=m.useState(s.temperatura_target),o=async l=>{x(l);try{await u.control(r.id,{temperatura_target:l,newConfig:{...s,temperatura_target:l}}),a==null||a()}catch(y){console.error("Errore cambio temperatura:",y)}},d=async()=>{try{await u.control(r.id,{acceso:!s.acceso,newConfig:{...s,acceso:!s.acceso}}),a==null||a()}catch(l){console.error("Errore toggle termostato:",l)}},n=()=>s.acceso?s.modalita==="riscaldamento"?"error":"success":"copy-lighter";return e.jsxs(f,{variant:"glass",hover:!0,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-3 rounded-xl bg-${n()} bg-opacity-20`,children:e.jsx(P,{size:24,className:`text-${n()}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-copy",children:r.nome}),e.jsx("p",{className:"text-xs text-copy-lighter capitalize",children:s.modalita})]})]}),e.jsx("button",{onClick:d,className:`p-2 rounded-lg ${s.acceso?"bg-primary text-white":"glass"}`,children:e.jsx(M,{size:16})})]}),e.jsxs("div",{className:"mb-4 glass rounded-lg p-6 text-center",children:[e.jsxs("div",{className:"text-5xl font-bold text-copy mb-2",children:[s.temperatura_corrente,"Â°"]}),e.jsx("div",{className:"text-sm text-copy-lighter",children:"Temperatura attuale"})]}),s.acceso&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between glass rounded-lg px-4 py-3",children:[e.jsx("button",{onClick:()=>o(t-.5),className:"p-2 hover:bg-foreground rounded-lg transition-colors",children:e.jsx(E,{size:20})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[t,"Â°"]}),e.jsx("div",{className:"text-xs text-copy-lighter",children:"Target"})]}),e.jsx("button",{onClick:()=>o(t+.5),className:"p-2 hover:bg-foreground rounded-lg transition-colors",children:e.jsx(p,{size:20})})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["riscaldamento","raffreddamento","auto"].map(l=>e.jsx("button",{className:`px-3 py-2 rounded-lg text-xs font-medium transition-colors ${s.modalita===l?"bg-primary text-white":"glass hover:bg-opacity-20"}`,children:l==="riscaldamento"?"ðŸ”¥":l==="raffreddamento"?"â„ï¸":"ðŸ”„"},l))})]})]})},ce=()=>{var k,S;const{id:r}=O(),a=W(),{user:s}=B(),{impiantoCorrente:t,fetchImpianto:x}=H(),[o,d]=m.useState(null),[n,l]=m.useState(null),[y,N]=m.useState(!1),[b,w]=m.useState(!1),j=(s==null?void 0:s.ruolo)===C.INSTALLATORE||(s==null?void 0:s.ruolo)===C.ADMIN,$=async()=>{try{await X.delete(t.id),a("/impianti")}catch(i){console.error("Errore durante eliminazione impianto:",i)}};if(m.useEffect(()=>{r&&x(parseInt(r))},[r]),m.useEffect(()=>{t!=null&&t.piani&&t.piani.length>0&&(d(t.piani[0].id),t.piani[0].stanze&&t.piani[0].stanze.length>0&&l(t.piani[0].stanze[0].id))},[t]),!t)return e.jsx(L,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"dark:text-copy-lighter light:text-copy-lighter",children:"Caricamento..."})})});const c=(k=t.piani)==null?void 0:k.find(i=>i.id===o),h=(S=c==null?void 0:c.stanze)==null?void 0:S.find(i=>i.id===n),z=(h==null?void 0:h.dispositivi)||[],_=i=>{switch(i.tipo){case v.LUCE:return e.jsx(Z,{dispositivo:i},i.id);case v.TAPPARELLA:return e.jsx(q,{dispositivo:i},i.id);case v.TERMOSTATO:return e.jsx(F,{dispositivo:i},i.id)}};return e.jsxs(L,{children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("button",{onClick:()=>a("/impianti"),className:"p-2 glass rounded-lg hover:bg-white/10 transition-colors flex-shrink-0",children:e.jsx(Q,{size:18})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-lg sm:text-xl font-bold dark:text-copy light:text-copy-light truncate",children:t.nome}),e.jsxs("p",{className:"text-[10px] sm:text-xs dark:text-copy-lighter light:text-copy-lighter truncate",children:[t.indirizzo,", ",t.citta]})]})]}),j&&e.jsxs("div",{className:"flex gap-1 flex-shrink-0",children:[e.jsx("button",{onClick:()=>a(`/impianti/${r}/settings`),className:"p-2 glass rounded-lg hover:bg-white/10 transition-colors",title:"Impostazioni",children:e.jsx(J,{size:18,className:"dark:text-copy light:text-copy-light"})}),e.jsx("button",{onClick:()=>N(!0),className:"p-2 rounded-lg hover:bg-error/20 transition-colors",title:"Elimina",children:e.jsx(K,{size:18,className:"text-error"})})]})]}),t.piani&&t.piani.length>0&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>w(!b),className:"w-full flex items-center justify-between p-3 glass rounded-xl",children:[e.jsx("span",{className:"font-medium dark:text-copy light:text-copy-light",children:(c==null?void 0:c.nome)||"Seleziona piano"}),e.jsx(R,{size:18,className:`transition-transform ${b?"rotate-180":""}`})]}),b&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 glass rounded-xl overflow-hidden z-20",children:[t.piani.filter(i=>i!==null).map(i=>e.jsx("button",{onClick:()=>{d(i.id),w(!1),i.stanze&&i.stanze.length>0&&l(i.stanze[0].id)},className:`w-full text-left px-4 py-3 transition-colors ${o===i.id?"bg-primary text-white":"hover:bg-white/10 dark:text-copy light:text-copy-light"}`,children:i.nome},i.id)),j&&e.jsxs("button",{className:"w-full text-left px-4 py-3 border-t dark:border-border light:border-border-light dark:text-copy-lighter light:text-copy-lighter hover:bg-white/10 flex items-center gap-2",children:[e.jsx(p,{size:14}),"Nuovo Piano"]})]})]}),(c==null?void 0:c.stanze)&&c.stanze.length>0&&e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-4 px-4 scrollbar-hide",children:[c.stanze.filter(i=>i!==null).map(i=>e.jsxs("button",{onClick:()=>l(i.id),className:`flex items-center gap-1.5 px-3 py-2 rounded-full whitespace-nowrap text-sm transition-colors flex-shrink-0 ${n===i.id?"bg-primary text-white":"glass dark:text-copy light:text-copy-light"}`,children:[e.jsx(V,{size:14}),i.nome]},i.id)),j&&e.jsxs("button",{className:"flex items-center gap-1.5 px-3 py-2 rounded-full whitespace-nowrap text-sm glass dark:text-copy-lighter light:text-copy-lighter flex-shrink-0",children:[e.jsx(p,{size:14}),"Nuova"]})]}),z.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3",children:z.filter(i=>i!=null).map(_)}):e.jsxs(f,{variant:"glass",className:"text-center py-8",children:[e.jsx(A,{size:32,className:"mx-auto mb-2 dark:text-copy-lighter light:text-copy-lighter"}),e.jsx("h3",{className:"text-sm font-semibold dark:text-copy light:text-copy-light mb-1",children:"Nessun dispositivo"}),e.jsx("p",{className:"text-xs dark:text-copy-lighter light:text-copy-lighter mb-3",children:h?`Aggiungi dispositivi a ${h.nome}`:"Seleziona una stanza"}),j&&h&&e.jsxs("button",{className:"px-3 py-1.5 rounded-lg bg-primary text-white text-xs font-medium",children:[e.jsx(p,{size:14,className:"inline mr-1"}),"Aggiungi"]})]})]}),e.jsx(Y,{isOpen:y,onClose:()=>N(!1),title:"Elimina Impianto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"dark:text-copy light:text-copy-light text-sm",children:["Sei sicuro di voler eliminare ",e.jsxs("strong",{children:['"',t==null?void 0:t.nome,'"']}),"?"]}),e.jsx("p",{className:"text-error text-xs",children:"Questa azione eliminerÃ  tutti i dati associati."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"glass",onClick:()=>N(!1),fullWidth:!0,children:"Annulla"}),e.jsx(g,{variant:"danger",onClick:$,fullWidth:!0,children:"Elimina"})]})]})})]})};export{ce as ImpiantoDettaglio};
