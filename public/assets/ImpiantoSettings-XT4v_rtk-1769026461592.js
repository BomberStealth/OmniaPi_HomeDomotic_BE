import{W as $,u as q,J as F,r as t,$ as x,j as e,g as G,M as _,a0 as H,a1 as J,a2 as Q,a3 as U,Z as V,H as r}from"./index-B7WG_kHJ-1769026461592.js";import{L as g}from"./Layout-BnB1agDJ-1769026461592.js";import{C as k}from"./Card-tMATpRxV-1769026461592.js";import{B as l}from"./Button-BLF6EOYE-1769026461592.js";import{I as d}from"./Input-Bz5_UG-L-1769026461592.js";import{M as S}from"./Modal-BJmk3CCX-1769026461592.js";import"./motion-DSM7Rpg2-1769026461592.js";import"./index-yirOBEcN-1769026461592.js";import"./useTranslation-CnXjuBvM-1769026461592.js";import"./responsive-BJrBEfWo-1769026461592.js";import"./omniapiApi-DDnppdd_-1769026461592.js";const ne=()=>{const{id:n}=$(),m=q(),{impianti:b,removeImpianto:L,fetchImpianti:M}=F(),[u,E]=t.useState(null),[R,w]=t.useState(!0),[v,j]=t.useState(!1),[i,c]=t.useState({nome:"",indirizzo:"",citta:"",cap:""}),[f,y]=t.useState(""),[A,p]=t.useState(!1),[D,N]=t.useState(!1),[h,C]=t.useState("");t.useEffect(()=>{n&&I()},[n]);const I=async()=>{try{const a=await x.getById(parseInt(n));a.success&&a.data&&(E(a.data),c({nome:a.data.nome,indirizzo:a.data.indirizzo||"",citta:a.data.citta||"",cap:a.data.cap||""}),y(a.data.codice_condivisione||""))}catch(a){console.error("Errore caricamento impianto:",a)}finally{w(!1)}},W=async()=>{var a,s;j(!0);try{await x.update(parseInt(n),i),r.success("Modifiche salvate con successo!"),I()}catch(o){r.error(((s=(a=o.response)==null?void 0:a.data)==null?void 0:s.error)||"Errore durante il salvataggio")}finally{j(!1)}},B=()=>{navigator.clipboard.writeText(f),r.success("Codice copiato negli appunti!")},P=async()=>{try{const a=await fetch(`/api/impianti/${n}/regenerate-code`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const s=await a.json();y(s.data.codice_condivisione),p(!1),r.success("Codice rigenerato con successo!")}else{const s=await a.json();r.error(s.error||"Errore durante la rigenerazione del codice")}}catch{r.error("Errore durante la rigenerazione del codice")}},T=async()=>{var a,s;if(h!=="ELIMINA"){r.error("Scrivi ELIMINA per confermare");return}try{const o=parseInt(n),O=b.length<=1;await x.delete(o),L(o),r.success("Impianto eliminato con successo"),O?m("/",{replace:!0}):(await M(),m("/impianti",{replace:!0}))}catch(o){r.error(((s=(a=o.response)==null?void 0:a.data)==null?void 0:s.error)||"Errore durante l'eliminazione")}},z=()=>{N(!1),C("")};return R?e.jsx(g,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"dark:text-copy-lighter light:text-copy-lighter",children:"Caricamento..."})})}):u?e.jsxs(g,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m(-1),className:"p-3 glass rounded-xl hover:bg-opacity-20 transition-colors",children:e.jsx(G,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold dark:text-copy light:text-copy-light",children:"Impostazioni Avanzate"}),e.jsx("p",{className:"dark:text-copy-lighter light:text-copy-lighter",children:u.nome})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(k,{variant:"glass-solid",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(_,{className:"text-primary",size:24}),e.jsx("h2",{className:"text-xl font-bold dark:text-copy light:text-copy-light",children:"Informazioni Generali"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{label:"Nome Impianto",value:i.nome,onChange:a=>c({...i,nome:a.target.value}),placeholder:"es. Casa Principale"}),e.jsx(d,{label:"Indirizzo",value:i.indirizzo,onChange:a=>c({...i,indirizzo:a.target.value}),placeholder:"es. Via Roma 123"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(d,{label:"CittÃ ",value:i.citta,onChange:a=>c({...i,citta:a.target.value}),placeholder:"es. Milano"}),e.jsx(d,{label:"CAP",value:i.cap,onChange:a=>c({...i,cap:a.target.value}),placeholder:"es. 20100",maxLength:5})]}),e.jsxs("div",{className:"mt-4 p-4 glass rounded-lg text-center",children:[e.jsx("p",{className:"text-2xl mb-2",children:"ðŸ—ºï¸"}),e.jsx("p",{className:"dark:text-copy-lighter light:text-copy-lighter text-sm",children:"Mappa in arrivo"})]})]})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs(k,{variant:"glass-solid",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(H,{className:"text-secondary",size:24}),e.jsx("h2",{className:"text-lg font-bold dark:text-copy light:text-copy-light",children:"Codice Condivisione"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"flex-1 glass rounded-lg px-4 py-3 font-mono text-xl font-bold text-center dark:text-copy light:text-copy-light",children:f||"N/A"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(l,{variant:"glass",size:"sm",onClick:B,fullWidth:!0,children:[e.jsx(J,{size:16,className:"mr-1"}),"Copia"]}),e.jsxs(l,{variant:"glass",size:"sm",onClick:()=>p(!0),fullWidth:!0,children:[e.jsx(Q,{size:16,className:"mr-1"}),"Rigenera"]})]}),e.jsx("p",{className:"text-xs dark:text-copy-lighter light:text-copy-lighter",children:"Condividi questo codice per dare accesso ad altri utenti"})]})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(l,{variant:"primary",onClick:W,disabled:v,children:[e.jsx(U,{size:20,className:"mr-2"}),v?"Salvataggio...":"Salva Modifiche"]}),e.jsxs(l,{variant:"danger",onClick:()=>N(!0),children:[e.jsx(V,{size:20,className:"mr-2"}),"Elimina Impianto"]})]})]}),e.jsx(S,{isOpen:A,onClose:()=>p(!1),title:"Rigenera Codice Condivisione",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"dark:text-copy-lighter light:text-copy-lighter",children:"Sei sicuro di voler rigenerare il codice di condivisione? Il codice attuale non sarÃ  piÃ¹ valido."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(l,{variant:"glass",onClick:()=>p(!1),fullWidth:!0,children:"Annulla"}),e.jsx(l,{variant:"primary",onClick:P,fullWidth:!0,children:"Rigenera"})]})]})}),e.jsx(S,{isOpen:D,onClose:z,title:"Elimina Impianto",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"dark:text-copy-lighter light:text-copy-lighter",children:"Sei sicuro di voler eliminare questo impianto? Questa azione Ã¨ irreversibile e cancellerÃ  anche tutti i dispositivi, scene e dati associati."}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium dark:text-copy-lighter light:text-copy-lighter mb-2",children:["Scrivi ",e.jsx("span",{className:"font-bold text-error",children:"ELIMINA"})," per confermare:"]}),e.jsx(d,{value:h,onChange:a=>C(a.target.value.toUpperCase()),placeholder:"ELIMINA",className:"text-center font-bold"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(l,{variant:"glass",onClick:z,fullWidth:!0,children:"Annulla"}),e.jsx(l,{variant:"danger",onClick:T,fullWidth:!0,disabled:h!=="ELIMINA",children:"Elimina Definitivamente"})]})]})})]}):e.jsx(g,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"dark:text-copy-lighter light:text-copy-lighter",children:"Impianto non trovato"})})})};export{ne as ImpiantoSettings};
